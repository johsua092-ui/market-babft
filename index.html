<!DOCTYPE html>
<html>
<head>
    <title>OXYX MARKET | OWNER ACCESS</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI',Arial,sans-serif; }
        body { background:#050505; color:white; padding:20px; }
        .container { max-width:1200px; margin:0 auto; }
        
        h1 { font-size:3.5em; text-align:center; color:#b300ff; text-shadow:0 0 20px #b300ff; margin-bottom:30px; }
        .card { background:#11111a; border:1px solid #333; border-radius:12px; padding:20px; margin-bottom:20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        /* MONITORING GRID */
        .stats { display:grid; grid-template-columns:repeat(3,1fr); gap:15px; margin-bottom:20px; }
        .stat-card { background:#1a1a2a; border-left:4px solid #b300ff; padding:15px; border-radius:5px; }
        .stat-value { font-size:1.8em; color:white; font-weight:bold; }
        
        /* TRACKER TABLE */
        .tracker-table { width:100%; border-collapse:collapse; margin-top:10px; font-size: 13px; }
        .tracker-table th { text-align:left; color:#b300ff; padding:10px; border-bottom:2px solid #333; }
        .tracker-table td { padding:12px; border-bottom:1px solid #222; }
        .id-text { color:#00ff00; font-family:monospace; }
        .ip-text { color:#ffaa00; font-family:monospace; }

        /* FORM */
        input, textarea, select { width:100%; padding:12px; margin:8px 0; background:#0a0a0a; border:1px solid #444; border-radius:5px; color:white; }
        .btn-oxy { width:100%; padding:15px; background:#b300ff; border:none; border-radius:5px; color:white; font-weight:bold; cursor:pointer; transition:0.3s; }
        .btn-oxy:hover { background:#d400ff; box-shadow: 0 0 15px #b300ff; }
        
        .hidden { display:none !important; }
        .product-card { background:#1a1a2a; border-radius:10px; overflow:hidden; border:1px solid #333; }
        .product-img { width:100%; height:150px; object-fit:cover; background:#000; }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚ö° OXYX MARKET ‚ö°</h1>
        
        <div class="stats">
            <div class="stat-card"><div class="stat-value" id="countMembers">0</div><div>Total Users</div></div>
            <div class="stat-card"><div class="stat-value" id="countBuilds">0</div><div>Builds Listed</div></div>
            <div class="stat-card"><div class="stat-value" id="myIP">Loading...</div><div>Your Current IP</div></div>
        </div>

        <div id="trackerSection" class="card hidden">
            <h2 style="color: #b300ff; margin-bottom:10px;">üì° LIVE FORENSIC TRACKER</h2>
            <table class="tracker-table">
                <thead>
                    <tr><th>User</th><th>IP Address</th><th>Device Fingerprint (ID)</th><th>Last Active</th></tr>
                </thead>
                <tbody id="trackerBody"></tbody>
            </table>
        </div>

        <div id="uploadCard" class="card hidden">
            <h2>üì§ PUBLISH NEW BUILD</h2>
            <label>1. Build File (.build)</label>
            <input type="file" id="uFile" accept=".build">
            
            <label>2. Build Description</label>
            <textarea id="uDesc" placeholder="Describe your masterpiece..."></textarea>
            
            <label>3. Market Type</label>
            <select id="uType">
                <option value="">-- Select Type --</option>
                <option value="free">Non-Premium (Free)</option>
                <option value="premium">Premium (Robux)</option>
            </select>

            <label>4. Build Name</label>
            <input type="text" id="uName" placeholder="Enter build name">

            <label>5. Build Photo (Optional)</label>
            <input type="file" id="uPhoto" accept="image/*">

            <button class="btn-oxy" onclick="processUpload()">PUBLISH BUILD</button>
        </div>

        <div class="card" id="loginCard">
            <h2>üîê ACCESS GATE</h2>
            <input type="text" id="lUser" placeholder="Username">
            <input type="password" id="lPass" placeholder="Password">
            <button class="btn-oxy" onclick="auth()">LOGIN</button>
        </div>

        <div class="card">
            <h2>üè™ CURRENT MARKET</h2>
            <div id="marketGrid" style="display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:20px; margin-top:15px;"></div>
        </div>
    </div>

    <script>
        let dbBuilds = JSON.parse(localStorage.getItem('oxy_builds')) || [];
        let dbUsers = JSON.parse(localStorage.getItem('oxy_users')) || [];
        let userSess = null;

        // Generate Device ID
        const getDID = () => btoa(navigator.userAgent + screen.width).substring(0, 12).toUpperCase();
        
        // Get IP
        fetch('https://api.ipify.org?format=json')
            .then(r => r.json())
            .then(d => { document.getElementById('myIP').innerText = d.ip; window.curIP = d.ip; });

        function auth() {
            const u = document.getElementById('lUser').value;
            const p = document.getElementById('lPass').value;

            if(u === 'znyt' && p === 'Root!Delta_7KpZ') {
                userSess = { name: u, role: 'owner' };
                document.getElementById('trackerSection').classList.remove('hidden');
                refreshTracker();
            } else {
                userSess = { name: u, role: 'member' };
            }

            // Simpan data user untuk tracker
            const entry = { name: u, ip: window.curIP || '0.0.0.0', did: getDID(), time: new Date().toLocaleString() };
            dbUsers.push(entry);
            localStorage.setItem('oxy_users', JSON.stringify(dbUsers));

            document.getElementById('loginCard').classList.add('hidden');
            document.getElementById('uploadCard').classList.remove('hidden');
            alert("Welcome, " + u);
            updateStats();
        }

        function processUpload() {
            const file = document.getElementById('uFile').files[0];
            const desc = document.getElementById('uDesc').value;
            const type = document.getElementById('uType').value;
            const name = document.getElementById('uName').value;
            const photo = document.getElementById('uPhoto').files[0];

            // Validasi Urutan sesuai instruksi
            if(!file) return alert("tolong upload file build anda");
            if(!desc) return alert("tolong tulis deskripsi build");
            if(!type) return alert("tolong pilih type build nya");
            if(!name) return alert("tolong beri nama buildnya");

            const reader = new FileReader();
            reader.onload = function(e) {
                const buildObj = {
                    id: Date.now(),
                    name: name,
                    desc: desc,
                    type: type,
                    fileName: file.name,
                    imgData: photo ? e.target.result : null
                };
                dbBuilds.push(buildObj);
                localStorage.setItem('oxy_builds', JSON.stringify(dbBuilds));
                
                alert(`‚úÖ build telah sukses di publish dan mengarah marketplace untuk yang ${type === 'premium' ? 'Premium' : 'Non-Premium'}`);
                location.reload();
            }

            if(photo) reader.readAsDataURL(photo);
            else {
                // Jika tidak ada foto, langsung simpan
                const buildObj = { id: Date.now(), name: name, desc: desc, type: type, fileName: file.name, imgData: null };
                dbBuilds.push(buildObj);
                localStorage.setItem('oxy_builds', JSON.stringify(dbBuilds));
                alert("‚úÖ Build sukses di publish tanpa foto.");
                location.reload();
            }
        }

        function refreshTracker() {
            const tbody = document.getElementById('trackerBody');
            tbody.innerHTML = dbUsers.slice(-10).reverse().map(u => `
                <tr>
                    <td><b>${u.name}</b></td>
                    <td class="ip-text">${u.ip}</td>
                    <td class="id-text">${u.did}</td>
                    <td>${u.time}</td>
                </tr>
            `).join('');
        }

        function renderMarket() {
            const grid = document.getElementById('marketGrid');
            grid.innerHTML = dbBuilds.map(b => `
                <div class="product-card">
                    <img src="${b.imgData || 'https://via.placeholder.com/300x150/111/fff?text=No+Image'}" class="product-img">
                    <div style="padding:15px;">
                        <h3 style="color:#b300ff;">${b.name}</h3>
                        <p style="font-size:12px; color:#888; margin:5px 0;">${b.desc}</p>
                        <div style="font-size:10px; color:#aaa;">File: ${b.fileName}</div>
                        <div style="margin-top:10px; font-weight:bold; color:${b.type==='premium'?'gold':'#00ff00'}">
                            ${b.type.toUpperCase()}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateStats() {
            document.getElementById('countMembers').innerText = dbUsers.length;
            document.getElementById('countBuilds').innerText = dbBuilds.length;
        }

        renderMarket();
        updateStats();
    </script>
</body>
</html>
