<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>OXYX MARKET - IP TRACKER</title>
    <style>
        body { background: black; color: white; font-family: Arial; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .card { background: #1a1a2a; border: 2px solid purple; padding: 20px; margin: 20px 0; border-radius: 10px; }
        input, button, textarea { width: 100%; padding: 12px; margin: 8px 0; background: #333; color: white; border: 1px solid purple; border-radius: 5px; }
        button { background: purple; cursor: pointer; font-weight: bold; }
        button:hover { background: #b87cff; }
        .hidden { display: none; }
        .build-card { background: #2a2a3a; border: 2px solid purple; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .chat-box { background: #0a0a1a; height: 150px; overflow-y: auto; padding: 10px; margin: 10px 0; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { background: purple; padding: 10px; text-align: left; }
        td { padding: 10px; border-bottom: 1px solid #333; }
        .online { color: #00ff00; }
        .offline { color: #666; }
        .ip-address { color: #ffaa00; }
        .device-id { color: #00ff00; }
        .ban-btn { background: #aa0000; padding: 5px 10px; width: auto; }
        .unban-btn { background: #00aa00; padding: 5px 10px; width: auto; }
        .stats { display: grid; grid-template-columns: repeat(4,1fr); gap: 15px; margin: 20px 0; }
        .stat-card { background: #2a0a3a; border: 2px solid gold; border-radius: 10px; padding: 15px; text-align: center; }
        .stat-value { font-size: 2.5em; color: gold; }
        .online-dot { display: inline-block; width: 10px; height: 10px; background: #00ff00; border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0%{opacity:1} 50%{opacity:0.5;transform:scale(1.3)} }
    </style>
</head>
<body>
    <div class="container">
        <h1>âš¡ OXYX MARKET âš¡</h1>
        
        <!-- DISCORD LINKS (ganti link sesuai keinginan) -->
        <div style="text-align:center; margin:20px 0;">
            <a href="https://discord.gg/autobuild" target="_blank" style="color:purple; margin:0 10px;">DISCORD 1</a>
            <a href="https://discord.gg/boatbuilderhub" target="_blank" style="color:purple; margin:0 10px;">DISCORD 2</a>
            <a href="https://discord.gg/boatbuilderhub" target="_blank" style="color:purple; margin:0 10px;">DISCORD 3</a>
        </div>
        
        <!-- STATS -->
        <div class="stats">
            <div class="stat-card"><div class="stat-value" id="totalMembers">0</div><div>Members</div></div>
            <div class="stat-card"><div class="stat-value" id="onlineNow">0</div><div><span class="online-dot"></span> Online</div></div>
            <div class="stat-card"><div class="stat-value" id="totalBuilds">0</div><div>Builds</div></div>
            <div class="stat-card"><div class="stat-value" id="totalIPs">0</div><div>IPs</div></div>
        </div>
        
        <!-- LOGIN MEMBER -->
        <div class="card">
            <h3>MEMBER LOGIN</h3>
            <input type="text" id="memberName" placeholder="Username">
            <button onclick="memberLogin()">LOGIN</button>
        </div>
        
        <!-- LOGIN ADMIN -->
        <div class="card">
            <h3>ADMIN LOGIN</h3>
            <input type="text" id="adminUser" placeholder="Username">
            <input type="password" id="adminPass" placeholder="Password">
            <button onclick="adminLogin()">LOGIN</button>
        </div>
        
        <!-- USER INFO -->
        <div id="userInfo" class="card hidden">
            <p>Logged in as: <span id="displayName"></span></p>
            <button onclick="logout()">LOGOUT</button>
        </div>
        
        <!-- IP TRACKER TABLE (HANYA UNTUK MOD/OWNER) -->
        <div id="ipTracker" class="card hidden">
            <h3>ðŸ“‹ IP TRACKER</h3>
            <table>
                <thead><tr><th>User</th><th>IP Address</th><th>Device ID</th><th>Last Seen</th><th>Status</th><th>Action</th></tr></thead>
                <tbody id="ipTableBody"></tbody>
            </table>
        </div>
        
        <!-- BANNED IPS TABLE -->
        <div id="bannedIPs" class="card hidden">
            <h3>ðŸš« BANNED IPS</h3>
            <table>
                <thead><tr><th>IP Address</th><th>Reason</th><th>Banned At</th><th>Action</th></tr></thead>
                <tbody id="banTableBody"></tbody>
            </table>
        </div>
        
        <!-- MOD CHAT -->
        <div id="chatSection" class="card hidden">
            <h3>MOD CHAT</h3>
            <div class="chat-box" id="chatMessages"></div>
            <input type="text" id="chatMsg" placeholder="Message">
            <button onclick="sendChat()">SEND</button>
        </div>
        
        <!-- UPLOAD BUILD -->
        <div id="uploadSection" class="card hidden">
            <h3>UPLOAD BUILD</h3>
            <input type="text" id="buildName" placeholder="Build name">
            <input type="number" id="buildPrice" value="0" placeholder="Price">
            <textarea id="buildDesc" placeholder="Description"></textarea>
            <input type="file" id="buildFile" accept=".build">
            <button onclick="uploadBuild()">PUBLISH</button>
        </div>
        
        <!-- MARKETPLACE -->
        <div class="card">
            <h3>MARKETPLACE</h3>
            <div style="display:flex; gap:5px; margin:10px 0;">
                <button onclick="showAll()">ALL</button>
                <button onclick="showFree()">FREE</button>
                <button onclick="showPremium()">PREMIUM</button>
                <button onclick="showMy()">MY BUILDS</button>
            </div>
            <div id="marketplace"></div>
        </div>
    </div>
    
    <script>
        // ========== DATA ==========
        let currentUser = null;
        let deviceId = 'DEV-' + Math.random().toString(36).substring(2,10).toUpperCase();
        let clientIP = 'Unknown';
        
        let members = JSON.parse(localStorage.getItem('members')) || [];
        let builds = JSON.parse(localStorage.getItem('builds')) || [
            {id:1, name:"Dragon Boat", price:0, desc:"Cool boat", file:"dragon.build", seller:"znyt", fileData:null},
            {id:2, name:"Flying Ship", price:150, desc:"Flying ship", file:"flying.build", seller:"helper_tester", fileData:null}
        ];
        let chats = JSON.parse(localStorage.getItem('chats')) || [];
        let bannedIPs = JSON.parse(localStorage.getItem('bannedIPs')) || [];
        
        // ========== AMBIL IP ==========
        fetch('https://api.ipify.org?format=json')
            .then(r => r.json())
            .then(d => { clientIP = d.ip; updateTables(); })
            .catch(() => { clientIP = '127.0.0.1'; updateTables(); });
        
        // ========== FUNGSI BANTU ==========
        function updateTables() {
            updateIpTable();
            updateBanTable();
            updateStats();
        }
        
        function updateStats() {
            document.getElementById('totalMembers').innerText = members.length;
            document.getElementById('totalBuilds').innerText = builds.length;
            let online = members.filter(m => new Date(m.lastSeen).getTime() > Date.now() - 86400000).length;
            document.getElementById('onlineNow').innerText = online;
            document.getElementById('totalIPs').innerText = [...new Set(members.map(m => m.ip))].length;
        }
        
        // ========== LOGIN MEMBER ==========
        window.memberLogin = function() {
            let name = document.getElementById('memberName').value.trim();
            if (!name) { alert('Masukin nama!'); return; }
            
            // Cek apakah IP dibanned
            if (bannedIPs.some(b => b.ip === clientIP)) {
                alert('IP Anda telah di-banned!');
                return;
            }
            
            let now = new Date().toISOString();
            let existing = members.find(m => m.username === name);
            if (existing) {
                existing.lastSeen = now;
                existing.ip = clientIP;
                existing.deviceId = deviceId;
            } else {
                members.push({
                    username: name,
                    ip: clientIP,
                    deviceId: deviceId,
                    firstSeen: now,
                    lastSeen: now,
                    loginCount: 1
                });
            }
            localStorage.setItem('members', JSON.stringify(members));
            
            currentUser = { username: name, role: 'member' };
            document.getElementById('userInfo').classList.remove('hidden');
            document.getElementById('displayName').innerText = name + ' (MEMBER)';
            document.getElementById('uploadSection').classList.remove('hidden');
            updateStats();
            alert('Welcome ' + name);
        };
        
        // ========== LOGIN ADMIN ==========
        window.adminLogin = function() {
            let user = document.getElementById('adminUser').value.trim();
            let pass = document.getElementById('adminPass').value.trim();
            
            // Cek IP banned
            if (bannedIPs.some(b => b.ip === clientIP)) {
                alert('IP Anda telah di-banned!');
                return;
            }
            
            // GANTI PASSWORD DI SINI
            if (user === 'znyt' && pass === 'Root!Delta_7KpZ') {
                currentUser = { username: 'znyt', role: 'owner' };
            } else if (user === 'helper_tester' && pass === 'huwydhdjsiqo') {
                currentUser = { username: 'helper_tester', role: 'mod' };
            } else if (user === 'sigma' && pass === 'uBwbONeqIwYQ97') {
                currentUser = { username: 'sigma', role: 'mod' };
            } else {
                alert('Salah password!');
                return;
            }
            
            // Record login
            let now = new Date().toISOString();
            let existing = members.find(m => m.username === user);
            if (existing) {
                existing.lastSeen = now;
                existing.ip = clientIP;
                existing.deviceId = deviceId;
            } else {
                members.push({
                    username: user,
                    ip: clientIP,
                    deviceId: deviceId,
                    firstSeen: now,
                    lastSeen: now,
                    loginCount: 1
                });
            }
            localStorage.setItem('members', JSON.stringify(members));
            
            document.getElementById('userInfo').classList.remove('hidden');
            document.getElementById('displayName').innerText = user + ' (' + currentUser.role.toUpperCase() + ')';
            document.getElementById('uploadSection').classList.remove('hidden');
            document.getElementById('chatSection').classList.remove('hidden');
            
            // Tampilkan IP tracker untuk mod/owner
            document.getElementById('ipTracker').classList.remove('hidden');
            document.getElementById('bannedIPs').classList.remove('hidden');
            updateTables();
            alert('Welcome ' + user);
        };
        
        window.logout = function() {
            currentUser = null;
            document.getElementById('userInfo').classList.add('hidden');
            document.getElementById('uploadSection').classList.add('hidden');
            document.getElementById('chatSection').classList.add('hidden');
            document.getElementById('ipTracker').classList.add('hidden');
            document.getElementById('bannedIPs').classList.add('hidden');
            alert('Logged out');
        };
        
        // ========== IP TABLE ==========
        function updateIpTable() {
            let tbody = document.getElementById('ipTableBody');
            if (!members.length) { tbody.innerHTML = '<tr><td colspan="6">No data</td></tr>'; return; }
            
            let html = '';
            members.sort((a,b) => new Date(b.lastSeen) - new Date(a.lastSeen)).forEach(m => {
                let online = new Date(m.lastSeen).getTime() > Date.now() - 86400000;
                let statusClass = online ? 'online' : 'offline';
                let statusText = online ? 'ðŸŸ¢ Online' : 'âš« Offline';
                let isBanned = bannedIPs.some(b => b.ip === m.ip);
                html += `
                    <tr>
                        <td>${m.username} ${isBanned ? 'ðŸš«' : ''}</td>
                        <td class="ip-address">${m.ip || 'Unknown'}</td>
                        <td class="device-id">${(m.deviceId || '').substring(0,10)}...</td>
                        <td>${new Date(m.lastSeen).toLocaleString()}</td>
                        <td class="${statusClass}">${statusText}</td>
                        <td>
                            ${currentUser && (currentUser.role === 'owner' || currentUser.role === 'mod') && !isBanned ? 
                                `<button class="ban-btn" onclick="banIP('${m.ip}', '${m.username}')">BAN</button>` : 
                                isBanned ? 'BANNED' : ''}
                        </td>
                    </tr>
                `;
            });
            tbody.innerHTML = html;
        }
        
        // ========== BAN IP ==========
        window.banIP = function(ip, username) {
            if (!currentUser || (currentUser.role !== 'owner' && currentUser.role !== 'mod')) {
                alert('Hanya moderator/owner yang bisa ban!');
                return;
            }
            
            let reason = prompt('Alasan ban (opsional):', 'Melanggar aturan');
            if (reason === null) return;
            
            bannedIPs.push({
                ip: ip,
                username: username,
                reason: reason || 'No reason',
                bannedAt: new Date().toLocaleString(),
                bannedBy: currentUser.username
            });
            localStorage.setItem('bannedIPs', JSON.stringify(bannedIPs));
            updateTables();
            alert(`IP ${ip} berhasil di-ban!`);
        };
        
        window.unbanIP = function(ip) {
            if (!currentUser || (currentUser.role !== 'owner' && currentUser.role !== 'mod')) {
                alert('Hanya moderator/owner yang bisa unban!');
                return;
            }
            
            bannedIPs = bannedIPs.filter(b => b.ip !== ip);
            localStorage.setItem('bannedIPs', JSON.stringify(bannedIPs));
            updateTables();
            alert(`IP ${ip} berhasil di-unban!`);
        };
        
        function updateBanTable() {
            let tbody = document.getElementById('banTableBody');
            if (!bannedIPs.length) { tbody.innerHTML = '<tr><td colspan="4">No banned IPs</td></tr>'; return; }
            
            let html = '';
            bannedIPs.forEach(b => {
                html += `
                    <tr>
                        <td class="ip-address">${b.ip}</td>
                        <td>${b.reason}</td>
                        <td>${b.bannedAt}</td>
                        <td>
                            ${currentUser && (currentUser.role === 'owner' || currentUser.role === 'mod') ? 
                                `<button class="unban-btn" onclick="unbanIP('${b.ip}')">UNBAN</button>` : ''}
                        </td>
                    </tr>
                `;
            });
            tbody.innerHTML = html;
        }
        
        // ========== CHAT ==========
        window.sendChat = function() {
            if (!currentUser || currentUser.role === 'member') {
                alert('Hanya mod/owner yang bisa chat');
                return;
            }
            let msg = document.getElementById('chatMsg').value.trim();
            if (!msg) return;
            
            chats.push({ user: currentUser.username, msg: msg, time: new Date().toLocaleTimeString() });
            localStorage.setItem('chats', JSON.stringify(chats));
            document.getElementById('chatMsg').value = '';
            displayChat();
        };
        
        function displayChat() {
            let box = document.getElementById('chatMessages');
            if (!chats.length) { box.innerHTML = ''; return; }
            let html = '';
            chats.slice(-10).forEach(c => {
                html += `<div><b>${c.user}:</b> ${c.msg}</div>`;
            });
            box.innerHTML = html;
        }
        
        // ========== UPLOAD BUILD ==========
        window.uploadBuild = function() {
            if (!currentUser) { alert('Login dulu!'); return; }
            
            if (bannedIPs.some(b => b.ip === clientIP)) {
                alert('IP Anda telah di-banned! Tidak bisa upload.');
                return;
            }
            
            let name = document.getElementById('buildName').value.trim();
            let price = parseInt(document.getElementById('buildPrice').value) || 0;
            let desc = document.getElementById('buildDesc').value.trim();
            let file = document.getElementById('buildFile').files[0];
            
            if (!name || !desc || !file) { alert('Isi semua!'); return; }
            
            let reader = new FileReader();
            reader.onload = function(e) {
                builds.push({
                    id: Date.now(),
                    name: name,
                    price: price,
                    desc: desc,
                    file: file.name,
                    fileData: e.target.result,
                    seller: currentUser.username
                });
                localStorage.setItem('builds', JSON.stringify(builds));
                alert('Upload berhasil!');
                showAll();
                document.getElementById('buildName').value = '';
                document.getElementById('buildPrice').value = '0';
                document.getElementById('buildDesc').value = '';
                document.getElementById('buildFile').value = '';
            };
            reader.readAsDataURL(file);
        };
        
        window.downloadBuild = function(fileData, fileName) {
            if (!fileData) { alert('File tidak ada!'); return; }
            let a = document.createElement('a');
            a.href = fileData;
            a.download = fileName;
            a.click();
        };
        
        window.deleteBuild = function(id, seller) {
            if (!currentUser) { alert('Login dulu!'); return; }
            if (currentUser.role !== 'owner' && currentUser.role !== 'mod' && currentUser.username !== seller) {
                alert('Tidak bisa hapus punya orang!');
                return;
            }
            builds = builds.filter(b => b.id !== id);
            localStorage.setItem('builds', JSON.stringify(builds));
            showAll();
            alert('Build dihapus!');
        };
        
        // ========== FILTER ==========
        window.showAll = function() { displayBuilds(builds); };
        window.showFree = function() { displayBuilds(builds.filter(b => b.price === 0)); };
        window.showPremium = function() { displayBuilds(builds.filter(b => b.price >= 100)); };
        window.showMy = function() {
            if (!currentUser) { alert('Login dulu!'); return; }
            displayBuilds(builds.filter(b => b.seller === currentUser.username));
        };
        
        function displayBuilds(filtered) {
            let html = '';
            filtered.reverse().forEach(b => {
                let canDelete = currentUser && (currentUser.role === 'owner' || currentUser.role === 'mod' || currentUser.username === b.seller);
                html += `
                    <div class="build-card">
                        <h3>${b.name}</h3>
