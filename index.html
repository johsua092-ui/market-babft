<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Secure Build Marketplace</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI',Arial,sans-serif; }
        body { background:#0a0a0a; color:white; padding:20px; }
        .container { max-width:1200px; margin:0 auto; }
        h1 { color:#4CAF50; text-align:center; margin-bottom:30px; border-bottom:2px solid #4CAF50; padding-bottom:10px; }
        .card { background:#1a1a2a; border:2px solid #4CAF50; border-radius:10px; padding:20px; margin-bottom:20px; }
        .auth-section { display:flex; gap:10px; margin-bottom:20px; justify-content:center; }
        .auth-section input { padding:10px 15px; background:#2a2a3a; border:1px solid #4CAF50; border-radius:5px; color:white; }
        .auth-section button { padding:10px 25px; background:#4CAF50; border:none; border-radius:5px; color:black; font-weight:bold; cursor:pointer; }
        .auth-section button:hover { background:#45a049; }
        .user-info { text-align:center; color:#4CAF50; margin-bottom:20px; font-weight:bold; }
        .user-info span { color:#888; }
        .form-group { margin:15px 0; }
        .form-group label { display:block; margin-bottom:5px; color:#4CAF50; font-weight:bold; }
        input, select, textarea { width:100%; padding:12px; margin:8px 0; background:#2a2a3a; border:2px solid #4CAF50; border-radius:5px; color:white; }
        textarea { resize:vertical; }
        .upload-btn { width:100%; padding:15px; background:#4CAF50; border:none; border-radius:5px; color:black; font-weight:bold; font-size:1.1em; cursor:pointer; margin-top:15px; }
        .upload-btn:hover { background:#45a049; }
        .status { padding:12px; border-radius:5px; margin:10px 0; display:none; }
        .success { background:#1a3a1a; border:1px solid #4CAF50; color:#4CAF50; }
        .error { background:#3a1a1a; border:1px solid #ff4444; color:#ff4444; }
        .info { background:#1a2a3a; border:1px solid #2196F3; color:#2196F3; }
        .filters { display:flex; gap:10px; margin:20px 0; flex-wrap:wrap; }
        .filter-btn { padding:10px 20px; background:#2a2a3a; border:2px solid #4CAF50; border-radius:5px; color:white; cursor:pointer; }
        .filter-btn.active { background:#4CAF50; color:black; font-weight:bold; }
        .marketplace { display:grid; grid-template-columns:repeat(auto-fill,minmax(300px,1fr)); gap:15px; }
        .build-card { background:#2a2a3a; border:2px solid #4CAF50; border-radius:5px; padding:15px; }
        .build-title { color:#4CAF50; font-size:1.2em; font-weight:bold; margin-bottom:10px; }
        .build-info { color:#aaa; font-size:0.9em; margin:8px 0; }
        .build-price { color:#FFD700; font-size:1.3em; font-weight:bold; margin:10px 0; }
        .build-desc { color:#ccc; margin:10px 0; line-height:1.5; }
        .build-seller { color:#888; font-size:0.85em; margin:10px 0; }
        .download-btn { width:100%; padding:10px; margin-top:10px; background:#4CAF50; border:none; border-radius:5px; color:black; font-weight:bold; cursor:pointer; }
        .download-btn:hover { background:#45a049; }
        .delete-btn { width:100%; padding:10px; margin-top:5px; background:#ff4444; border:none; border-radius:5px; color:white; font-weight:bold; cursor:pointer; }
        .delete-btn:hover { background:#cc0000; }
        .footer { text-align:center; color:#666; margin-top:30px; padding-top:20px; border-top:1px solid #333; }
        .hidden { display:none !important; }
        .file-size { color:#888; font-size:0.85em; }
    </style>
</head>
<body>
<div class="container">
    <h1>üèóÔ∏è SECURE BUILD MARKETPLACE</h1>

    <!-- AUTH SECTION -->
    <div class="card">
        <h3>üîê Authentication</h3>
        <div class="auth-section">
            <input type="text" id="username" placeholder="Enter username (3+ chars)" maxlength="20">
            <button onclick="login()">LOGIN</button>
            <button onclick="logout()" class="hidden" id="logoutBtn">LOGOUT</button>
        </div>
        <div id="authStatus" class="status"></div>
        <div id="userInfo" class="user-info hidden"></div>
    </div>

    <!-- UPLOAD SECTION -->
    <div id="uploadSection" class="card hidden">
        <h3>üì§ UPLOAD BUILD</h3>
        <div class="form-group">
            <label>Build Name</label>
            <input type="text" id="buildName" placeholder="e.g., Cool Ship Design" maxlength="50">
        </div>
        <div class="form-group">
            <label>Type</label>
            <select id="buildType">
                <option value="Ship">üö¢ Ship</option>
                <option value="Plane">‚úàÔ∏è Plane</option>
                <option value="Mech">ü§ñ Mech</option>
                <option value="Vehicle">üöó Vehicle</option>
            </select>
        </div>
        <div class="form-group">
            <label>Price (Robux)</label>
            <input type="number" id="buildPrice" min="0" max="1000000" value="0" placeholder="0 for free">
        </div>
        <div class="form-group">
            <label>Description</label>
            <textarea id="buildDesc" rows="4" placeholder="Describe your build..." maxlength="500"></textarea>
        </div>
        <div class="form-group">
            <label>Build File (.build)</label>
            <input type="file" id="buildFile" accept=".build" required>
        </div>
        <button class="upload-btn" onclick="uploadBuild()">üöÄ PUBLISH BUILD</button>
        <div id="uploadStatus" class="status"></div>
    </div>

    <!-- MARKETPLACE -->
    <div class="card">
        <h3>üè™ MARKETPLACE</h3>
        <div class="filters">
            <button class="filter-btn active" onclick="filterBuilds('all', this)">üìã ALL</button>
            <button class="filter-btn" onclick="filterBuilds('free', this)">üÜì FREE</button>
            <button class="filter-btn" onclick="filterBuilds('paid', this)">üíé PAID</button>
            <button class="filter-btn" onclick="filterBuilds('mybuilds', this)">üë§ MY UPLOADS</button>
        </div>
        <div id="marketplace" class="marketplace">
            <p style="color:#666;">Loading marketplace...</p>
        </div>
    </div>

    <div class="footer">
        Secure Build Marketplace ‚Ä¢ Transparent ‚Ä¢ No Hidden Access ‚Ä¢ Proper File Handling
    </div>
</div>

<script>
    // ========== SECURE DATA MANAGEMENT ==========
    const STORAGE_KEY = 'marketplace_data';
    const SESSION_KEY = 'user_session';
    
    let currentUser = null;
    let currentFilter = 'all';

    // Initialize
    function init() {
        loadSession();
        loadMarketplace();
        updateUI();
    }

    // ========== AUTHENTICATION ==========
    function login() {
        const username = document.getElementById('username').value.trim();
        
        if (!username || username.length < 3) {
            showStatus('authStatus', '‚ùå Username must be 3+ characters', 'error');
            return;
        }

        if (!/^[a-zA-Z0-9_]+$/.test(username)) {
            showStatus('authStatus', '‚ùå Username can only contain letters, numbers, underscores', 'error');
            return;
        }

        currentUser = username;
        sessionStorage.setItem(SESSION_KEY, username);
        showStatus('authStatus', `‚úÖ Logged in as ${username}`, 'success');
        updateUI();
    }

    function logout() {
        currentUser = null;
        sessionStorage.removeItem(SESSION_KEY);
        document.getElementById('username').value = '';
        showStatus('authStatus', '‚úÖ Logged out', 'success');
        updateUI();
    }

    function loadSession() {
        currentUser = sessionStorage.getItem(SESSION_KEY);
    }

    // ========== UI UPDATES ==========
    function updateUI() {
        const uploadSection = document.getElementById('uploadSection');
        const userInfo = document.getElementById('userInfo');
        const logoutBtn = document.getElementById('logoutBtn');

        if (currentUser) {
            uploadSection.classList.remove('hidden');
            userInfo.classList.remove('hidden');
            userInfo.innerHTML = `üë§ Logged in as <span>${currentUser}</span>`;
            logoutBtn.classList.remove('hidden');
            document.getElementById('username').classList.add('hidden');
        } else {
            uploadSection.classList.add('hidden');
            userInfo.classList.add('hidden');
            logoutBtn.classList.add('hidden');
            document.getElementById('username').classList.remove('hidden');
        }
    }

    // ========== FILE UPLOAD ==========
    function uploadBuild() {
        if (!currentUser) {
            showStatus('uploadStatus', '‚ùå Please log in first', 'error');
            return;
        }

        const name = document.getElementById('buildName').value.trim();
        const type = document.getElementById('buildType').value;
        const price = parseInt(document.getElementById('buildPrice').value) || 0;
        const desc = document.getElementById('buildDesc').value.trim();
        const fileInput = document.getElementById('buildFile');

        // Validation
        if (!name) {
            showStatus('uploadStatus', '‚ùå Build name is required', 'error');
            return;
        }
        if (!desc) {
            showStatus('uploadStatus', '‚ùå Description is required', 'error');
            return;
        }
        if (!fileInput.files[0]) {
            showStatus('uploadStatus', '‚ùå Please select a .build file', 'error');
            return;
        }

        const file = fileInput.files[0];
        
        if (!file.name.toLowerCase().endsWith('.build')) {
            showStatus('uploadStatus', '‚ùå File must be .build format', 'error');
            return;
        }

        if (file.size > 10 * 1024 * 1024) { // 10MB limit
            showStatus('uploadStatus', '‚ùå File too large (max 10MB)', 'error');
            return;
        }

        showStatus('uploadStatus', '‚è≥ Uploading...', 'info');

        const reader = new FileReader();
        reader.onload = function(e) {
            const builds = loadMarketplace();
            
            builds.push({
                id: Date.now(),
                name: name,
                type: type,
                price: price,
                desc: desc,
                fileName: file.name,
                fileData: e.target.result, // Base64 encoded
                seller: currentUser,
                uploadedAt: new Date().toISOString(),
                fileSize: file.size
            });

            saveMarketplace(builds);
            
            // Clear form
            document.getElementById('buildName').value = '';
            document.getElementById('buildPrice').value = '0';
            document.getElementById('buildDesc').value = '';
            document.getElementById('buildFile').value = '';

            showStatus('uploadStatus', '‚úÖ Build published successfully!', 'success');
            loadMarketplace();
        };

        reader.onerror = function() {
            showStatus('uploadStatus', '‚ùå Error reading file', 'error');
        };

        reader.readAsDataURL(file);
    }

    // ========== FILE DOWNLOAD ==========
    function downloadBuild(buildId) {
        const builds = loadMarketplace();
        const build = builds.find(b => b.id === buildId);

        if (!build) {
            showStatus('uploadStatus', '‚ùå Build not found', 'error');
            return;
        }

        try {
            const link = document.createElement('a');
            link.href = build.fileData;
            link.download = build.fileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showStatus('uploadStatus', `‚úÖ Downloaded: ${build.fileName}`, 'success');
        } catch(e) {
            showStatus('uploadStatus', '‚ùå Download failed', 'error');
        }
    }

    // ========== MARKETPLACE MANAGEMENT ==========
    function loadMarketplace() {
        const data = localStorage.getItem(STORAGE_KEY);
        return data ? JSON.parse(data) : [];
    }

    function saveMarketplace(builds) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(builds));
    }

    function deleteBuild(buildId) {
        if (!confirm('Are you sure you want to delete this build?')) return;

        let builds = loadMarketplace();
        const build = builds.find(b => b.id === buildId);

        if (!build) {
            showStatus('uploadStatus', '‚ùå Build not found', 'error');
            return;
        }

        if (build.seller !== currentUser) {
            showStatus('uploadStatus', '‚ùå You can only delete your own builds', 'error');
            return;
        }

        builds = builds.filter(b => b.id !== buildId);
        saveMarketplace(builds);
        displayMarketplace();
        showStatus('uploadStatus', '‚úÖ Build deleted', 'success');
    }

    function filterBuilds(filter, btn) {
        currentFilter = filter;
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        displayMarketplace();
    }

    function displayMarketplace() {
        const marketplace = document.getElementById('marketplace');
        let builds = loadMarketplace();

        // Apply filters
        if (currentFilter === 'free') {
            builds = builds.filter(b => b.price === 0);
        } else if (currentFilter === 'paid') {
            builds = builds.filter(b => b.price > 0);
        } else if (currentFilter === 'mybuilds') {
            if (!currentUser) {
                marketplace.innerHTML = '<p style="color:#666;">Log in to see your builds</p>';
                return;
            }
            builds = builds.filter(b => b.seller === currentUser);
        }

        if (builds.length === 0) {
            marketplace.innerHTML = '<p style="color:#666;">No builds found</p>';
            return;
        }

        // Display builds (newest first)
        let html = '';
        builds.slice().reverse().forEach(build => {
            const uploadDate = new Date(build.uploadedAt).toLocaleDateString();
            const fileSize = (build.fileSize / 1024).toFixed(2);
            const isOwner = currentUser === build.seller;

            html += `
                <div class="build-card">
                    <div class="build-title">${escapeHtml(build.name)}</div>
                    <div class="build-info">Type: ${build.type}</div>
                    <div class="build-price">üí∞ ${build.price} Robux</div>
                    <div class="build-desc">${escapeHtml(build.desc)}</div>
                    <div class="build-seller">By: ${escapeHtml(build.seller)}</div>
                    <div class="file-size">üì¶ ${fileSize}KB | ${uploadDate}</div>
                    <button class="download-btn" onclick="downloadBuild(${build.id})">‚¨áÔ∏è DOWNLOAD</button>
                    ${isOwner ? `<button class="delete-btn" onclick="deleteBuild(${build.id})">üóëÔ∏è DELETE</button>` : ''}
                </div>
            `;
        });

        marketplace.innerHTML = html;
    }

    // ========== UTILITIES ==========
    function escapeHtml(text) {
        const map = {
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#039;'
        };
        return text.replace(/[&<>"']/g, m => map[m]);
    }

    function showStatus(id, msg, type) {
        const el = document.getElementById(id);
        el.style.display = 'block';
        el.className = 'status ' + type;
        el.textContent = msg;
        setTimeout(() => el.style.display = 'none', 4000);
    }

    // Start app
    init();
</script>
</body>
</html>
