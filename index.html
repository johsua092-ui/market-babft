<!DOCTYPE html>
<html>
<head>
    <title>OXYX MARKET | OWNER FIXED</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI',Arial,sans-serif; }
        body { background:#0a0a0a; color:white; padding:20px; }
        .container { max-width:1400px; margin:0 auto; }
        h1 { font-size:4em; text-align:center; color:#b300ff; text-shadow:3px 3px 0 #ff00ff,-3px -3px 0 #00ffff; margin-bottom:30px; }
        .card { background:#1a1a2a; border:2px solid #b300ff; border-radius:15px; padding:20px; margin-bottom:20px; }
        .stats { display:grid; grid-template-columns:repeat(3,1fr); gap:15px; margin:20px 0; }
        .stat-card { background:#2a0a3a; border:2px solid gold; border-radius:10px; padding:15px; text-align:center; }
        .stat-value { font-size:2.5em; color:gold; }
        .tracker-table { width:100%; border-collapse:collapse; margin-top:15px; font-size:13px; }
        .tracker-table th { background:#b300ff; padding:12px; text-align:left; }
        .tracker-table td { padding:10px; border-bottom:1px solid #333; }
        input, textarea, select { width:100%; padding:12px; margin:8px 0; background:#2a2a3a; border:2px solid #b300ff; border-radius:5px; color:white; }
        button { width:100%; padding:15px; background:#b300ff; border:none; border-radius:5px; color:white; font-weight:bold; cursor:pointer; margin-top:5px; }
        button:hover { background:#d400ff; }
        .hidden { display:none !important; }
        .market-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(300px,1fr)); gap:20px; margin-top:20px; }
        .build-card { background:#2a2a3a; border:2px solid #b300ff; border-radius:10px; overflow:hidden; position:relative; }
        .build-img { width:100%; height:180px; object-fit:cover; background:#000; border-bottom:2px solid #b300ff; }
        .price-tag { position:absolute; top:10px; right:10px; background:gold; color:black; padding:5px 10px; font-weight:bold; border-radius:5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚ö° OXYX MARKET ‚ö°</h1>
        
        <div class="stats">
            <div class="stat-card"><div class="stat-value" id="s_users">0</div><div>Total Members</div></div>
            <div class="stat-card"><div class="stat-value" id="s_builds">0</div><div>Total Builds</div></div>
            <div class="stat-card"><div class="stat-value" id="s_online">0</div><div>Online Member & Staff</div></div>
        </div>

        <div id="ownerPanel" class="card hidden">
            <h2 style="color:gold;">üëë OWNER FORENSIC MONITOR</h2>
            <div style="margin:10px 0; display:flex; gap:10px;">
                <button onclick="exportData()" style="background:gold; color:black; font-size:11px;">üì§ SYNC: GET CODE</button>
                <button onclick="importData()" style="background:#00ff00; color:black; font-size:11px;">üì• SYNC: PASTE CODE</button>
                <button onclick="clearLogs()" style="background:red; font-size:11px;">üóëÔ∏è CLEAR LOGS</button>
            </div>
            <table class="tracker-table">
                <thead><tr><th>User</th><th>IP Address</th><th>Device ID</th><th>Last Activity</th></tr></thead>
                <tbody id="trackerBody"></tbody>
            </table>
        </div>

        <div id="loginCard" class="card">
            <h2>üîê LOGIN ACCESS</h2>
            <input type="text" id="userIn" placeholder="Username">
            <input type="password" id="passIn" placeholder="Password (Staff Only)">
            <button onclick="handleLogin()">ENTER SYSTEM</button>
        </div>

        <div id="uploadCard" class="card hidden">
            <h2 id="greetUser">üì§ UPLOAD YOUR BUILD</h2>
            <input type="file" id="f_file" accept=".build">
            <textarea id="f_desc" placeholder="Build Description..."></textarea>
            <select id="f_type">
                <option value="">-- Choose Type --</option>
                <option value="free">Non-Premium (Free)</option>
                <option value="premium">Premium (Robux)</option>
            </select>
            <input type="text" id="f_name" placeholder="Build Name">
            <input type="file" id="f_photo" accept="image/*">
            <button onclick="publishBuild()">PUBLISH BUILD</button>
            <button onclick="logout()" style="background:#aa0000;">LOGOUT</button>
        </div>

        <div class="card">
            <h2>üè™ BABFT MARKETPLACE</h2>
            <div id="marketGrid" class="market-grid"></div>
        </div>
    </div>

    <script>
        let currentUser = JSON.parse(sessionStorage.getItem('oxy_session')) || null;
        let builds = JSON.parse(localStorage.getItem('oxy_v7_builds')) || [];
        let logs = JSON.parse(localStorage.getItem('oxy_v7_logs')) || [];
        let fetchedIP = "Detecting...";

        const myDID = btoa(navigator.userAgent).substring(0, 12).toUpperCase();

        async function getIP() {
            try {
                const res = await fetch('https://api.ipify.org?format=json');
                const d = await res.json(); fetchedIP = d.ip;
            } catch(e) { fetchedIP = "Hidden/VPN"; }
        }
        getIP();

        // Cek Sesi Saat Halaman Dibuka
        window.onload = function() {
            if(currentUser) {
                showDashboard();
            }
            refreshMarket();
            updateStats();
        };

        async function handleLogin() {
            const u = document.getElementById('userIn').value.trim();
            const p = document.getElementById('passIn').value;
            if(!u) return alert("Enter Username!");
            
            await getIP();
            
            if(u === 'znyt' && p === 'Root!Delta_7KpZ') currentUser = { name: u, role: 'owner' };
            else if ((u === 'helper_tester' && p === 'huwydhdjsiqo') || (u === 'sigma' && p === 'uBwbONeqIwYQ97')) currentUser = { name: u, role: 'mod' };
            else currentUser = { name: u, role: 'member' };

            sessionStorage.setItem('oxy_session', JSON.stringify(currentUser));
            
            logs.push({ name: u, ip: fetchedIP, did: myDID, time: new Date().toLocaleString(), role: currentUser.role });
            localStorage.setItem('oxy_v7_logs', JSON.stringify(logs));

            showDashboard();
            alert("‚úÖ Login Sukses!");
        }

        function showDashboard() {
            document.getElementById('loginCard').classList.add('hidden');
            document.getElementById('uploadCard').classList.remove('hidden');
            document.getElementById('greetUser').innerText = `üì§ WELCOME, ${currentUser.name.toUpperCase()}`;
            
            if(currentUser.role === 'owner') {
                document.getElementById('ownerPanel').classList.remove('hidden');
                refreshTracker();
            }
            refreshMarket();
            updateStats();
        }

        function publishBuild() {
            const file = document.getElementById('f_file').files[0];
            const desc = document.getElementById('f_desc').value.trim();
            const type = document.getElementById('f_type').value;
            const name = document.getElementById('f_name').value.trim();
            const photo = document.getElementById('f_photo').files[0];

            if(!file || !desc || !type || !name) return alert("Lengkapi semua data!");

            const reader = new FileReader();
            reader.onload = (e) => {
                builds.push({ id: Date.now(), owner: currentUser.name, name: name, desc: desc, type: type, file: file.name, img: photo ? e.target.result : null });
                localStorage.setItem('oxy_v7_builds', JSON.stringify(builds));
                alert("‚úÖ Build Published!");
                refreshMarket(); updateStats();
            };
            if(photo) reader.readAsDataURL(photo); else reader.onload({target:{result:null}});
        }

        function deleteBuild(id) {
            if(confirm("Hapus build ini?")) {
                builds = builds.filter(b => b.id !== id);
                localStorage.setItem('oxy_v7_builds', JSON.stringify(builds));
                refreshMarket(); updateStats();
            }
        }

        function refreshMarket() {
            const grid = document.getElementById('marketGrid');
            grid.innerHTML = builds.slice().reverse().map(b => {
                const canDelete = currentUser && (currentUser.name === b.owner || currentUser.role === 'owner' || currentUser.role === 'mod');
                return `
                    <div class="build-card">
                        <div class="price-tag">${b.type.toUpperCase()}</div>
                        <img src="${b.img || 'https://via.placeholder.com/300x180/111/fff?text=No+Photo'}" class="build-img">
                        <div style="padding:15px;">
                            <h3 style="color:gold;">${b.name}</h3>
                            <p style="font-size:11px; color:#ccc;">${b.desc}</p>
                            <p style="font-size:10px; color:#888;">By: ${b.owner}</p>
                            <div style="display:flex; gap:10px; margin-top:10px;">
                                <button style="padding:8px; font-size:11px; background:#00aa00;">DOWNLOAD</button>
                                ${canDelete ? `<button style="padding:8px; font-size:11px; background:#aa0000;" onclick="deleteBuild(${b.id})">DELETE</button>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function refreshTracker() {
            document.getElementById('trackerBody').innerHTML = logs.slice(-20).reverse().map(l => `
                <tr><td><b>${l.name}</b> [${l.role}]</td><td style="color:#ffaa00;">${l.ip}</td><td style="color:#00ff00;">${l.did}</td><td>${l.time}</td></tr>
            `).join('');
        }

        function updateStats() {
            document.getElementById('s_users').innerText = [...new Set(logs.map(l => l.name))].length;
            document.getElementById('s_builds').innerText = builds.length;
            const now = Date.now();
            document.getElementById('s_online').innerText = logs.filter(l => (now - new Date(l.time).getTime()) < 600000).length;
        }

        function exportData() {
            const code = btoa(JSON.stringify({builds, logs}));
            prompt("COPY CODE UNTUK SYNC KE HP:", code);
        }

        function importData() {
            const code = prompt("PASTE CODE SYNC DISINI:");
            if(code) {
                const d = JSON.parse(atob(code));
                localStorage.setItem('oxy_v7_builds', JSON.stringify(d.builds));
                localStorage.setItem('oxy_v7_logs', JSON.stringify(d.logs));
                location.reload();
            }
        }

        function clearLogs() {
            if(confirm("Hapus semua log forensic?")) {
                localStorage.setItem('oxy_v7_logs', JSON.stringify([]));
                location.reload();
            }
        }

        function logout() { sessionStorage.removeItem('oxy_session'); location.reload(); }
    </script>
</body>
</html>
