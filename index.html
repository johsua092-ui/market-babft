<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>OXYX MARKET - IP REAL</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI',Arial,sans-serif; }
        body { background:#0a0a0a; color:white; padding:20px; }
        .container { max-width:1400px; margin:0 auto; }
        
        h1 { font-size:4em; text-align:center; color:#b300ff; text-shadow:3px 3px 0 #ff00ff,-3px -3px 0 #00ffff; margin-bottom:30px; }
        
        .card { background:#1a1a2a; border:2px solid #b300ff; border-radius:15px; padding:20px; margin-bottom:20px; }
        
        .stats { display:grid; grid-template-columns:repeat(3,1fr); gap:15px; margin:20px 0; }
        .stat-card { background:#2a0a3a; border:2px solid gold; border-radius:10px; padding:15px; text-align:center; }
        .stat-value { font-size:2.5em; color:gold; }
        .online-dot { display:inline-block; width:10px; height:10px; background:#00ff00; border-radius:50%; animation:pulse 2s infinite; }
        @keyframes pulse { 0%{opacity:1} 50%{opacity:0.5;transform:scale(1.3)} }
        
        .device-info { background:#0a0a1a; padding:15px; border-radius:5px; font-family:monospace; margin-top:15px; }
        .device-id { color:#00ff00; }
        .ip-addr { color:#ffaa00; }
        
        .login-grid { display:grid; grid-template-columns:1fr 1fr; gap:20px; }
        input { width:100%; padding:12px; margin:8px 0; background:#2a2a3a; border:2px solid #b300ff; border-radius:5px; color:white; }
        
        .btn { width:100%; padding:15px; background:#b300ff; border:none; border-radius:5px; color:white; font-weight:bold; cursor:pointer; margin:5px 0; }
        .btn:hover { background:#d400ff; }
        .btn-red { background:#aa0000; }
        .btn-red:hover { background:#ff0000; }
        .btn-green { background:#00aa00; }
        
        .ip-table { width:100%; border-collapse:collapse; margin-top:15px; }
        .ip-table th { background:#b300ff; padding:12px; text-align:left; }
        .ip-table td { padding:10px; border-bottom:1px solid #333; }
        
        .hidden { display:none !important; }
        .footer { text-align:center; color:#666; margin-top:30px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚ö° OXYX MARKET ‚ö°</h1>
        
        <!-- STATS -->
        <div class="stats">
            <div class="stat-card"><div class="stat-value" id="totalMembers">0</div><div>Members</div></div>
            <div class="stat-card"><div class="stat-value" id="onlineNow">0</div><div><span class="online-dot"></span> Online</div></div>
            <div class="stat-card"><div class="stat-value" id="totalBuilds">0</div><div>Builds</div></div>
        </div>
        
        <!-- DEVICE INFO - PAKE IP ASLI -->
        <div class="card">
            <h2>üì± DEVICE INFO</h2>
            <div class="device-info">
                <p>Device ID: <span class="device-id" id="deviceId">LOADING...</span></p>
                <p>IP Address: <span class="ip-addr" id="ipAddress">DETECTING...</span></p>
                <p><small id="ipStatus">Mengambil IP...</small></p>
            </div>
        </div>
        
        <!-- LOGIN SECTION -->
        <div class="card">
            <h2>üîê LOGIN</h2>
            <div class="login-grid">
                <div>
                    <h3>üë§ MEMBER</h3>
                    <input type="text" id="memberUsername" placeholder="Username">
                    <button class="btn" id="btnMemberLogin">LOGIN MEMBER</button>
                </div>
                <div>
                    <h3>üëë ADMIN</h3>
                    <input type="text" id="adminUser" placeholder="Username">
                    <input type="password" id="adminPass" placeholder="Password">
                    <div id="verifySection" class="hidden" style="margin:10px 0; padding:15px; background:#2a0a3a; border-radius:5px;">
                        <div style="font-size:2em; color:gold; text-align:center;" id="verifyCodeDisplay">123456</div>
                        <input type="text" id="verifyCodeInput" placeholder="Kode 6 digit">
                        <button class="btn" id="btnVerifyCode">VERIFY</button>
                    </div>
                    <button class="btn" id="btnAdminLogin">LOGIN ADMIN</button>
                </div>
            </div>
            
            <div id="sessionWarning" class="hidden" style="background:#aa0000; padding:10px; border-radius:5px; text-align:center; margin:10px 0;">
                ‚ö†Ô∏è Account sudah aktif di device lain!
            </div>
            
            <div id="userInfo" class="hidden" style="margin-top:20px; padding:15px; background:#2a0a3a; border-radius:5px;">
                <p>Logged in as: <span id="displayName"></span></p>
                <button class="btn btn-red" id="btnLogout">LOGOUT</button>
            </div>
        </div>
        
        <!-- IP TRACKER -->
        <div id="ipTableSection" class="card hidden">
            <h2>üëë IP TRACKER</h2>
            <table class="ip-table">
                <thead><tr><th>User</th><th>IP</th><th>Device</th><th>Last Seen</th><th>Status</th><th>Action</th></tr></thead>
                <tbody id="ipTableBody"></tbody>
            </table>
        </div>
        
        <!-- BANNED IPS -->
        <div id="banSection" class="card hidden">
            <h2>üö´ BANNED IPS</h2>
            <table class="ip-table">
                <thead><tr><th>IP</th><th>User</th><th>Reason</th><th>Banned At</th><th>Action</th></tr></thead>
                <tbody id="banTableBody"></tbody>
            </table>
        </div>
        
        <!-- MOD CHAT -->
        <div id="chatSection" class="card hidden">
            <h2>üí¨ MOD CHAT</h2>
            <div id="chatMessages" style="height:150px; overflow:auto; background:#0a0a1a; padding:10px; margin:10px 0;"></div>
            <input type="text" id="chatMsg" placeholder="Message">
            <button class="btn" id="btnSendChat">SEND</button>
        </div>
        
        <!-- UPLOAD -->
        <div id="uploadSection" class="card hidden">
            <h2>üì§ UPLOAD BUILD</h2>
            <input type="text" id="buildName" placeholder="Build name">
            <input type="number" id="buildPrice" min="0" value="0" placeholder="Price">
            <textarea id="buildDesc" rows="3" placeholder="Description"></textarea>
            <input type="file" id="buildFile" accept=".build">
            <button class="btn" id="btnUpload">PUBLISH</button>
        </div>
        
        <!-- MARKETPLACE -->
        <div class="card">
            <h2>üè™ MARKETPLACE</h2>
            <div style="display:flex; gap:10px; margin:15px 0;">
                <button class="btn" id="filterAll">ALL</button>
                <button class="btn" id="filterFree">FREE</button>
                <button class="btn" id="filterPremium">PREMIUM</button>
                <button class="btn" id="filterMy">MY BUILDS</button>
            </div>
            <div id="marketplace" style="display:grid; grid-template-columns:repeat(auto-fill,minmax(250px,1fr)); gap:15px;"></div>
        </div>
        
        <div class="footer">OXYX MARKET ‚Ä¢ Build A Boat Only ‚Ä¢ IP REAL</div>
    </div>
    
    <script>
        // ========== DATA ==========
        let currentUser = null;
        let currentFilter = 'all';
        let pendingAdmin = null;
        
        // Device ID
        let deviceId = 'DEVICE-' + Math.random().toString(36).substring(2,10).toUpperCase();
        let clientIP = 'Mengambil IP...';
        
        // Data storage
        let members = JSON.parse(localStorage.getItem('members')) || [];
        let builds = JSON.parse(localStorage.getItem('builds')) || [
            {id:1, name:"Dragon Boat", price:0, desc:"Cool boat", file:"dragon.build", seller:"znyt"},
            {id:2, name:"Flying Ship", price:150, desc:"Flying ship", file:"flying.build", seller:"helper_tester"},
            {id:3, name:"Golden Raft", price:200, desc:"Golden raft", file:"golden.build", seller:"sigma"}
        ];
        let chats = JSON.parse(localStorage.getItem('chats')) || [{user:"znyt",msg:"Welcome!"}];
        let bannedIPs = JSON.parse(localStorage.getItem('bannedIPs')) || [];
        let activeSessions = JSON.parse(localStorage.getItem('activeSessions')) || {};
        
        // ========== AMBIL IP ASLI DARI 3 SUMBER ==========
        document.getElementById('deviceId').innerText = deviceId;
        
        // Coba API 1 (paling reliable)
        fetch('https://api.ipify.org?format=json')
            .then(r => r.json())
            .then(d => { 
                clientIP = d.ip; 
                document.getElementById('ipAddress').innerText = clientIP;
                document.getElementById('ipStatus').innerText = 'IP Real (ipify.org)';
            })
            .catch(() => {
                // Coba API 2
                fetch('https://jsonip.com')
                    .then(r => r.json())
                    .then(d => { 
                        clientIP = d.ip; 
                        document.getElementById('ipAddress').innerText = clientIP;
                        document.getElementById('ipStatus').innerText = 'IP Real (jsonip.com)';
                    })
                    .catch(() => {
                        // API 3
                        fetch('https://httpbin.org/ip')
                            .then(r => r.json())
                            .then(d => { 
                                clientIP = d.origin; 
                                document.getElementById('ipAddress').innerText = clientIP;
                                document.getElementById('ipStatus').innerText = 'IP Real (httpbin.org)';
                            })
                            .catch(() => {
                                clientIP = 'Gagal deteksi IP';
                                document.getElementById('ipAddress').innerText = clientIP;
                                document.getElementById('ipStatus').innerText = 'Gagal fetch IP';
                            });
                    });
            });
        
        // ========== SESSION ==========
        function checkSession(user) {
            if (user === 'znyt') return false;
            return activeSessions[user] && activeSessions[user] !== deviceId;
        }
        
        function setSession(user) {
            activeSessions[user] = deviceId;
            localStorage.setItem('activeSessions', JSON.stringify(activeSessions));
        }
        
        function clearSession(user) {
            delete activeSessions[user];
            localStorage.setItem('activeSessions', JSON.stringify(activeSessions));
        }
        
        // ========== STATS ==========
        function updateStats() {
            document.getElementById('totalMembers').innerText = members.length;
            document.getElementById('totalBuilds').innerText = builds.length;
            let online = members.filter(m => new Date(m.lastSeen).getTime() > Date.now() - 86400000).length;
            document.getElementById('onlineNow').innerText = online;
        }
        
        // ========== LOGIN MEMBER ==========
        function loginMember() {
            let user = document.getElementById('memberUsername').value.trim();
            if (!user) { alert('Masukin nama!'); return; }
            
            if (checkSession(user)) { 
                document.getElementById('sessionWarning').classList.remove('hidden');
                alert('‚ùå Account dipakai device lain!'); 
                return; 
            }
            
            let now = new Date().toISOString();
            let existing = members.find(m => m.username === user);
            
            if (existing) {
                existing.lastSeen = now;
                existing.ip = clientIP;
                existing.deviceId = deviceId;
                existing.loginCount = (existing.loginCount || 0) + 1;
            } else {
                members.push({ username: user, ip: clientIP, deviceId: deviceId, firstSeen: now, lastSeen: now, loginCount: 1 });
            }
            
            setSession(user);
            localStorage.setItem('members', JSON.stringify(members));
            
            currentUser = { username: user, role: 'member' };
            document.getElementById('userInfo').classList.remove('hidden');
            document.getElementById('displayName').innerText = user + ' (MEMBER)';
            document.getElementById('uploadSection').classList.remove('hidden');
            updateStats();
            alert('‚úÖ Welcome ' + user);
        }
        
        // ========== LOGIN ADMIN ==========
        function initiateAdminLogin() {
            let user = document.getElementById('adminUser').value.trim();
            let pass = document.getElementById('adminPass').value.trim();
            
            if (checkSession(user)) { 
                document.getElementById('sessionWarning').classList.remove('hidden');
                alert('‚ùå Account dipakai device lain!'); 
                return; 
            }
            
            let role = '';
            if (user === 'znyt' && pass === 'Root!Delta_7KpZ') role = 'owner';
            else if (user === 'helper_tester' && pass === 'huwydhdjsiqo') role = 'mod';
            else if (user === 'sigma' && pass === 'uBwbONeqIwYQ97') role = 'mod';
            
            if (!role) { alert('‚ùå Wrong credentials'); return; }
            
            let code = Math.floor(100000 + Math.random() * 900000).toString();
            document.getElementById('verifyCodeDisplay').innerText = code;
            document.getElementById('verifySection').classList.remove('hidden');
            pendingAdmin = { username: user, role: role };
        }
        
        function verifyCode() {
            if (!pendingAdmin) return;
            
            let inputCode = document.getElementById('verifyCodeInput').value.trim();
            let displayCode = document.getElementById('verifyCodeDisplay').innerText;
            
            if (inputCode !== displayCode) { alert('‚ùå Kode salah!'); return; }
            
            let user = pendingAdmin.username;
            let role = pendingAdmin.role;
            
            currentUser = { username: user, role: role };
            setSession(user);
            
            let now = new Date().toISOString();
            let existing = members.find(m => m.username === user);
            
            if (existing) {
                existing.lastSeen = now;
                existing.ip = clientIP;
                existing.deviceId = deviceId;
            } else {
                members.push({ username: user, ip: clientIP, deviceId: deviceId, firstSeen: now, lastSeen: now, loginCount: 1 });
            }
            localStorage.setItem('members', JSON.stringify(members));
            
            document.getElementById('userInfo').classList.remove('hidden');
            document.getElementById('displayName').innerText = user + ' (' + role.toUpperCase() + ')';
            document.getElementById('uploadSection').classList.remove('hidden');
            document.getElementById('chatSection').classList.remove('hidden');
            document.getElementById('verifySection').classList.add('hidden');
            
            if (role === 'owner') {
                document.getElementById('ipTableSection').classList.remove('hidden');
                document.getElementById('banSection').classList.remove('hidden');
                updateIpTable();
            } else {
                document.getElementById('banSection').classList.remove('hidden');
            }
            updateBanTable();
            updateStats();
            alert('‚úÖ Welcome ' + user);
            document.getElementById('verifyCodeInput').value = '';
            pendingAdmin = null;
        }
        
        function logout() {
            if (currentUser) clearSession(currentUser.username);
            currentUser = null;
            pendingAdmin = null;
            
            document.getElementById('userInfo').classList.add('hidden');
            document.getElementById('uploadSection').classList.add('hidden');
            document.getElementById('chatSection').classList.add('hidden');
            document.getElementById('ipTableSection').classList.add('hidden');
            document.getElementById('banSection').classList.add('hidden');
            document.getElementById('verifySection').classList.add('hidden');
            document.getElementById('sessionWarning').classList.add('hidden');
            alert('Logged out');
        }
        
        // ========== IP TABLE ==========
        function updateIpTable() {
            let tbody = document.getElementById('ipTableBody');
            if (!members.length) { tbody.innerHTML = '<tr><td colspan="6">No members</td></tr>'; return; }
            
            let html = '';
            members.sort((a,b) => new Date(b.lastSeen) - new Date(a.lastSeen)).forEach(m => {
                let online = new Date(m.lastSeen).getTime() > Date.now() - 86400000;
                let banned = bannedIPs.some(b => b.ip === m.ip);
                let status = online ? 'üü¢ ONLINE' : '‚ö´ OFFLINE';
                html += `<tr>
                    <td>${m.username} ${banned ? 'üö´' : ''}</td>
                    <td>${m.ip || 'Unknown'}</td>
                    <td>${(m.deviceId || '').substring(0,10)}...</td>
                    <td>${new Date(m.lastSeen).toLocaleString()}</td>
                    <td>${status}</td>
                    <td>${!banned ? `<button class="btn btn-red" onclick="banIP('${m.ip}', '${m.username}')">BAN</button>` : ''}</td>
                </tr>`;
            });
            tbody.innerHTML = html;
        }
        
        function banIP(ip, username) {
            if (!currentUser || (currentUser.role !== 'owner' && currentUser.role !== 'mod')) {
                alert('‚ùå Only mods/owner can ban!'); return;
            }
            let reason = prompt('Reason:', 'Violating rules');
            if (!reason) return;
            
            bannedIPs.push({ ip, username, reason, bannedAt: new Date().toLocaleString(), bannedBy: currentUser.username });
            localStorage.setItem('bannedIPs', JSON.stringify(bannedIPs));
            if (currentUser.role === 'owner') updateIpTable();
            updateBanTable();
            alert(`‚úÖ IP ${ip} banned!`);
        }
        
        function unbanIP(ip) {
            if (!currentUser || (currentUser.role !== 'owner' && currentUser.role !== 'mod')) {
                alert('‚ùå Only mods/owner can unban!'); return;
            }
            bannedIPs = bannedIPs.filter(b => b.ip !== ip);
            localStorage.setItem('bannedIPs', JSON.stringify(bannedIPs));
            if (currentUser.role === 'owner') updateIpTable();
            updateBanTable();
            alert(`‚úÖ IP ${ip} unbanned!`);
        }
        
        function updateBanTable() {
            let tbody = document.getElementById('banTableBody');
            if (!bannedIPs.length) { tbody.innerHTML = '<tr><td colspan="5">No banned IPs</td></tr>'; return; }
            let html = '';
            bannedIPs.forEach(b => {
                html += `<tr>
                    <td>${b.ip}</td><td>${b.username}</td><td>${b.reason}</td>
                    <td>${b.bannedAt}</td>
                    <td><button class="btn btn-green" onclick="unbanIP('${b.ip}')">UNBAN</button></td>
                </tr>`;
            });
            tbody.innerHTML = html;
        }
        
        // ========== CHAT ==========
        function sendChat() {
            if (!currentUser || currentUser.role === 'member') { alert('‚ùå Only mods/owner can chat!'); return; }
            let msg = document.getElementById('chatMsg').value.trim();
            if (!msg) return;
            chats.push({ user: currentUser.username, msg });
            localStorage.setItem('chats', JSON.stringify(chats));
