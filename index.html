<!DOCTYPE html>
<html>
<head>
    <title>OXYX MARKET</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI',Arial,sans-serif; }
        body { background:#0a0a0a; color:white; padding:20px; }
        .container { max-width:1200px; margin:0 auto; }
        h1 { color:#b87cff; text-align:center; margin-bottom:30px; border-bottom:2px solid #9f4dff; padding-bottom:10px; }
        .card { background:#1a1a2a; border:2px solid #9f4dff; border-radius:10px; padding:20px; margin-bottom:20px; }
        .discord-links { display:flex; gap:10px; justify-content:center; margin:20px 0; flex-wrap:wrap; }
        .discord-links a { padding:10px 20px; background:#5865F2; color:white; text-decoration:none; border-radius:5px; }
        .key-section { display:flex; gap:10px; margin:20px 0; }
        .key-section input { flex:1; padding:12px; background:#2a2a3a; border:2px solid #9f4dff; border-radius:5px; color:white; }
        .key-section button { padding:12px 30px; background:#9f4dff; border:none; border-radius:5px; color:white; cursor:pointer; }
        .status { padding:10px; border-radius:5px; margin:10px 0; display:none; }
        .success { background:#1a3a1a; border:1px solid #00ff00; color:#00ff00; }
        .error { background:#3a1a1a; border:1px solid #ff0000; color:#ff0000; }
        .chat-box { background:#0a0a1a; border:2px solid #9f4dff; border-radius:5px; padding:15px; height:200px; overflow-y:auto; margin-bottom:15px; display:flex; flex-direction:column; }
        .chat-message { padding:8px; border-bottom:1px solid #333; width:100%; }
        .chat-message b { color:#b87cff; }
        .publish-btn { width:100%; padding:15px; background:#9f4dff; border:none; border-radius:5px; color:white; font-size:1.2em; cursor:pointer; margin-top:15px; }
        .sort-buttons { display:flex; gap:10px; margin:20px 0; }
        .sort-btn { flex:1; padding:12px; background:#2a2a3a; border:2px solid #9f4dff; border-radius:5px; color:white; cursor:pointer; }
        .sort-btn.active { background:#9f4dff; }
        .build-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(300px,1fr)); gap:15px; }
        .build-card { background:#2a2a3a; border:2px solid #9f4dff; border-radius:5px; padding:15px; }
        .build-card.free { border-color:#00ff00; }
        .build-card.premium { border-color:gold; }
        .build-price { font-size:1.2em; font-weight:bold; margin:10px 0; }
        .free .build-price { color:#00ff00; }
        .premium .build-price { color:gold; }
        .download-btn { width:100%; padding:12px; margin-top:15px; background:#00aa00; border:none; border-radius:5px; color:white; font-weight:bold; cursor:pointer; font-size:1em; }
        .download-btn:hover { background:#00ff00; }
        .footer { text-align:center; color:#666; margin-top:30px; padding-top:20px; border-top:1px solid #333; }
        input, select, textarea { width:100%; padding:12px; margin:8px 0; background:#2a2a3a; border:2px solid #9f4dff; border-radius:5px; color:white; }
        .admin-section { display:none; margin-top:20px; padding:20px; background:#2a1a3a; border:2px solid gold; border-radius:10px; }
        .admin-btn { background:gold; color:black; font-weight:bold; padding:10px 20px; border:none; border-radius:5px; cursor:pointer; margin:5px; }
        .admin-btn:hover { background:#ffaa00; }
        .super-bypass { font-size:0.8em; color:#666; text-align:center; margin-top:10px; cursor:pointer; }
        .super-bypass:hover { color:#9f4dff; }
    </style>
</head>
<body>
<div class="container">
    <h1>‚ö° OXYX MARKET ‚ö°</h1>

    <div class="discord-links">
        <a href="https://discord.gg/autobuild" target="_blank">MAIN SERVER</a>
        <a href="https://discord.gg/boatbuilderhub" target="_blank">SUPPORT 1</a>
        <a href="https://discord.gg/boatbuilderhub" target="_blank">SUPPORT 2</a>
    </div>

    <div class="card">
        <h3>üîê MODERATOR/OWNER ONLY</h3>
        <div class="key-section">
            <input type="password" id="keyInput" placeholder="Enter moderator key">
            <button onclick="activateKey()">ACTIVATE</button>
        </div>
        <div id="keyStatus" class="status"></div>
        <div class="super-bypass" onclick="showBypass()">üîì SUPER BYPASS (click 7x)</div>
    </div>

    <!-- SUPER BYPASS PANEL -->
    <div id="bypassPanel" class="admin-section">
        <h3 style="color:gold;">üëë SUPER ADMIN BYPASS</h3>
        <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <button class="admin-btn" onclick="bypassAs('owner')">BYPASS AS OWNER</button>
            <button class="admin-btn" onclick="bypassAs('mod1')">BYPASS AS MOD 1</button>
            <button class="admin-btn" onclick="bypassAs('mod2')">BYPASS AS MOD 2</button>
            <button class="admin-btn" onclick="resetBypass()">RESET BYPASS</button>
        </div>
        <div id="bypassStatus" class="status" style="margin-top:10px;"></div>
    </div>

    <div id="modSection" style="display:none;" class="card">
        <h3>üí¨ MOD CHAT</h3>
        <div class="chat-box" id="chatMessages">Loading...</div>
        <div style="display:flex; gap:10px;">
            <input type="text" id="chatInput" placeholder="Type message..." style="flex:1;">
            <button onclick="sendChat()">SEND</button>
        </div>
    </div>

    <div class="card">
        <h3>üì§ UPLOAD BUILD</h3>
        <input type="text" id="buildName" placeholder="Build Name">
        <select id="buildType">
            <option value="Ship">üö¢ Ship</option>
            <option value="Plane">‚úàÔ∏è Plane</option>
            <option value="Mech">ü§ñ Mech</option>
        </select>
        <input type="number" id="buildPrice" min="0" value="0" placeholder="Price (Robux)">
        <textarea id="buildDesc" rows="3" placeholder="Build description..."></textarea>
        <input type="file" id="buildFile" accept=".build">
        <button class="publish-btn" onclick="publishBuild()">üöÄ PUBLISH BUILD</button>
        <div id="uploadStatus" class="status"></div>
    </div>

    <div class="sort-buttons">
        <button class="sort-btn active" onclick="filterBuilds('all', event)">üìã ALL</button>
        <button class="sort-btn" onclick="filterBuilds('free', event)">üÜì FREE (0)</button>
        <button class="sort-btn" onclick="filterBuilds('premium', event)">üíé PREMIUM (90-100)</button>
    </div>

    <div class="card">
        <h3>üè™ MARKETPLACE</h3>
        <div id="marketplace" class="build-grid">Loading...</div>
    </div>

    <div class="footer">OXYX MARKET ‚Ä¢ Only Moderators Can Publish ‚Ä¢ Everyone Can Download</div>
</div>

<script>
const API_KEY = '$2a$10$RYz0R2fKkR23Gf1qGguLi.5Tlr.5UlfHymp1bYXB5Zhp352m4fdua';
const BIN_ID = '69a24d2a43b1c97be9a53651';
const API_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;
let builds=[], chats=[], isMod=false, currentUser='', currentFilter='all';
let bypassClickCount = 0;
let bypassTimer = null;

async function loadData() {
    try {
        const res = await fetch(API_URL + '/latest', { headers:{ 'X-Access-Key':API_KEY }});
        const data = await res.json();
        builds = data.record.builds || [];
        chats = data.record.chats || [];
        displayBuilds();
        displayChats();
    } catch(e){console.error(e);}
}

async function saveData(){
    try {
        await fetch(API_URL,{method:'PUT', headers:{'Content-Type':'application/json','X-Access-Key':API_KEY}, body:JSON.stringify({builds,chats})});
        return true;
    } catch(e){console.error(e); return false;}
}

// ========== NORMAL KEY SYSTEM ==========
function activateKey(){
    const key=document.getElementById('keyInput').value;
    const status=document.getElementById('keyStatus');
    if(['owner_oxyx_2026','mod1_builder_2026','mod2_helper_2026'].includes(key)){
        isMod=true; currentUser=key;
        document.getElementById('modSection').style.display='block';
        showStatus('keyStatus','‚úÖ Key valid! Welcome '+key,'success');
        displayChats();
    } else showStatus('keyStatus','‚ùå Wrong key!','error');
}

// ========== SUPER BYPASS SYSTEM ==========
function showBypass() {
    bypassClickCount++;
    
    // Reset counter if not clicked within 2 seconds
    if (bypassTimer) clearTimeout(bypassTimer);
    bypassTimer = setTimeout(() => {
        bypassClickCount = 0;
    }, 2000);
    
    // Show bypass panel after 7 clicks
    if (bypassClickCount >= 7) {
        document.getElementById('bypassPanel').style.display = 'block';
        bypassClickCount = 0;
        showBypassStatus('üîì Super bypass activated!', 'success');
    }
}

function bypassAs(role) {
    let userRole = '';
    let displayName = '';
    
    switch(role) {
        case 'owner':
            userRole = 'owner_oxyx_2026';
            displayName = 'OWNER';
            break;
        case 'mod1':
            userRole = 'mod1_builder_2026';
            displayName = 'MODERATOR 1';
            break;
        case 'mod2':
            userRole = 'mod2_helper_2026';
            displayName = 'MODERATOR 2';
            break;
    }
    
    isMod = true;
    currentUser = userRole;
    document.getElementById('modSection').style.display = 'block';
    document.getElementById('bypassPanel').style.display = 'block';
    showBypassStatus(`‚úÖ Bypassed as ${displayName}!`, 'success');
    displayChats();
}

function resetBypass() {
    isMod = false;
    currentUser = '';
    document.getElementById('modSection').style.display = 'none';
    document.getElementById('bypassPanel').style.display = 'none';
    showBypassStatus('üîÑ Bypass reset', 'success');
}

function showBypassStatus(msg, type) {
    const el = document.getElementById('bypassStatus');
    el.style.display = 'block';
    el.className = 'status ' + type;
    el.textContent = msg;
    setTimeout(() => el.style.display = 'none', 3000);
}

function showStatus(id,msg,type){
    const el=document.getElementById(id);
    el.style.display='block'; el.className='status '+type; el.textContent=msg;
    setTimeout(()=>el.style.display='none',3000);
}

// ========== CHAT FUNCTIONS ==========
function displayChats(){
    const box=document.getElementById('chatMessages');
    if(!box) return;
    let html='';
    if(chats.length===0){
        html='<p style="color:#666;">No messages yet</p>';
    } else {
        chats.forEach(c => {
            html+=`<div class="chat-message"><b>${c.user}:</b> ${c.msg}</div>`;
        });
    }
    box.innerHTML=html;
    box.scrollTop = box.scrollHeight;
}

async function sendChat(){
    if(!isMod){ alert('‚ùå Only moderators can chat!'); return; }
    const msg=document.getElementById('chatInput').value.trim();
    if(!msg) return;
    
    chats.push({user:currentUser,msg,time:new Date().toLocaleTimeString()});
    
    if(await saveData()){ 
        document.getElementById('chatInput').value=''; 
        await loadData();
    } else showStatus('keyStatus','‚ùå Failed to send message','error');
}

// ========== PUBLISH BUILD ==========
async function publishBuild(){
    if(!isMod){ alert('‚ùå Only moderators can publish builds!'); return; }
    const name=document.getElementById('buildName').value.trim();
    const type=document.getElementById('buildType').value;
    const price=parseInt(document.getElementById('buildPrice').value);
    const desc=document.getElementById('buildDesc').value.trim();
    const fileInput=document.getElementById('buildFile');
    if(!name||!type||!desc||!fileInput.files[0]) { alert('Fill all fields!'); return; }
    const file=fileInput.files[0];
    if(!file.name.toLowerCase().endsWith('.build')){ alert('File must be .build!'); return; }

    showStatus('uploadStatus','‚è´ Uploading...', 'success');

    const reader = new FileReader();
    reader.onload = async function(e) {
        builds.push({
            id:Date.now(),
            name,type,price,desc,
            fileName:file.name,
            fileData:e.target.result,
            seller:currentUser
        });
        
        if(await saveData()){
            document.getElementById('buildName').value='';
            document.getElementById('buildPrice').value='0';
            document.getElementById('buildDesc').value='';
            document.getElementById('buildFile').value='';
            showStatus('uploadStatus','‚úÖ Build published successfully!','success');
            await loadData();
        } else showStatus('uploadStatus','‚ùå Failed to publish','error');
    };
    reader.readAsDataURL(file);
}

function downloadBuild(fileData,fileName){
    if (!fileData) {
        alert('‚ùå File not available!');
        return;
    }
    try {
        const link=document.createElement('a'); 
        link.href=fileData; 
        link.download=fileName;
        document.body.appendChild(link); 
        link.click();
        setTimeout(()=>document.body.removeChild(link),1000);
    } catch (error) {
        alert('‚ùå Download failed: ' + error.message);
    }
}

function filterBuilds(filter,evt){
    currentFilter=filter;
    document.querySelectorAll('.sort-btn').forEach(btn=>btn.classList.remove('active'));
    if(evt) evt.currentTarget.classList.add('active');
    displayBuilds();
}

function displayBuilds(){
    const grid=document.getElementById('marketplace');
    let filtered=builds;
    if(currentFilter==='free') filtered=builds.filter(b=>b.price===0);
    if(currentFilter==='premium') filtered=builds.filter(b=>b.price>=90&&b.price<=100);
    if(filtered.length===0){ grid.innerHTML='<p style="text-align:center;color:#666;">No builds available</p>'; return;}
    let html='';
    filtered.slice().reverse().forEach(b=>{
        const isFree=b.price===0; const isPremium=b.price>=90&&b.price<=100;
        let cardClass=isFree?'free':(isPremium?'premium':'');
        html+=`<div class="build-card ${cardClass}">
            <h3>${b.name}</h3><div>${b.type}</div>
            <div class="build-price">üí∞ ${b.price} Robux</div>
            <p>${b.desc}</p>
            <div style="margin-top:10px;"><small>Seller: ${b.seller}</small></div>
            ${b.fileData?`<button class="download-btn" onclick="downloadBuild('${b.fileData}','${b.fileName}')">‚¨áÔ∏è DOWNLOAD ${b.fileName}</button>`:''}
        </div>`;
    });
    grid.innerHTML=html;
}

setInterval(loadData,3000);
loadData();
</script>
</body>
</html>
