<!DOCTYPE html>
<html>
<head>
    <title>OXYX MARKET | BABFT</title>
    <style>
        /* UI KEMBALI KE STYLE SEBELUMNYA */
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI',Arial,sans-serif; }
        body { background:#0a0a0a; color:white; padding:20px; }
        .container { max-width:1400px; margin:0 auto; }
        
        h1 { font-size:4em; text-align:center; color:#b300ff; text-shadow:3px 3px 0 #ff00ff,-3px -3px 0 #00ffff; margin-bottom:30px; }
        .card { background:#1a1a2a; border:2px solid #b300ff; border-radius:15px; padding:20px; margin-bottom:20px; }
        
        /* STATS & TRACKER */
        .stats { display:grid; grid-template-columns:repeat(3,1fr); gap:15px; margin:20px 0; }
        .stat-card { background:#2a0a3a; border:2px solid gold; border-radius:10px; padding:15px; text-align:center; }
        .stat-value { font-size:2.5em; color:gold; }
        
        .tracker-table { width:100%; border-collapse:collapse; margin-top:15px; font-size:13px; }
        .tracker-table th { background:#b300ff; padding:12px; text-align:left; }
        .tracker-table td { padding:10px; border-bottom:1px solid #333; }

        /* INPUTS */
        input, textarea, select { width:100%; padding:12px; margin:8px 0; background:#2a2a3a; border:2px solid #b300ff; border-radius:5px; color:white; }
        button { width:100%; padding:15px; background:#b300ff; border:none; border-radius:5px; color:white; font-weight:bold; cursor:pointer; }
        button:hover { background:#d400ff; }
        
        .hidden { display:none !important; }
        
        /* MARKET GRID */
        .market-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(300px,1fr)); gap:20px; margin-top:20px; }
        .build-card { background:#2a2a3a; border:2px solid #b300ff; border-radius:10px; overflow:hidden; position:relative; }
        .build-img { width:100%; height:180px; object-fit:cover; background:#000; border-bottom:2px solid #b300ff; }
        .price-tag { position:absolute; top:10px; right:10px; background:gold; color:black; padding:5px 10px; font-weight:bold; border-radius:5px; }
        
        .footer { text-align:center; color:#666; margin-top:30px; letter-spacing:2px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚ö° OXYX MARKET ‚ö°</h1>
        
        <div class="stats">
            <div class="stat-card"><div class="stat-value" id="s_users">0</div><div>Users Active</div></div>
            <div class="stat-card"><div class="stat-value" id="s_builds">0</div><div>Total Builds</div></div>
            <div class="stat-card"><div class="stat-value" id="s_ip">Scanning...</div><div>Your Address</div></div>
        </div>

        <div id="ownerPanel" class="card hidden">
            <h2 style="color:gold;">üëë OWNER FORENSIC MONITOR</h2>
            <table class="tracker-table">
                <thead><tr><th>User</th><th>IP Address</th><th>Device ID</th><th>Last Activity</th></tr></thead>
                <tbody id="trackerBody"></tbody>
            </table>
        </div>

        <div id="loginCard" class="card">
            <h2>üîê LOGIN ACCESS</h2>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px;">
                <input type="text" id="userIn" placeholder="Username">
                <input type="password" id="passIn" placeholder="Password (Empty for Member)">
            </div>
            <button onclick="handleLogin()" style="margin-top:10px;">ENTER SYSTEM</button>
        </div>

        <div id="uploadCard" class="card hidden">
            <h2 id="greetUser">üì§ UPLOAD YOUR BUILD</h2>
            <input type="file" id="f_file" accept=".build">
            <textarea id="f_desc" placeholder="Build Description..."></textarea>
            <select id="f_type">
                <option value="">-- Choose Type --</option>
                <option value="free">Non-Premium (Free)</option>
                <option value="premium">Premium (Robux)</option>
            </select>
            <input type="text" id="f_name" placeholder="Build Name">
            <label style="font-size:12px; color:gold;">Add Photo (JPG/PNG):</label>
            <input type="file" id="f_photo" accept="image/*">
            <button onclick="publishBuild()">PUBLISH BUILD</button>
            <button onclick="logout()" style="background:#aa0000; margin-top:10px;">LOGOUT</button>
        </div>

        <div class="card">
            <h2>üè™ BABFT MARKETPLACE</h2>
            <div id="marketGrid" class="market-grid"></div>
        </div>

        <div class="footer">OXYX MARKET ‚Ä¢ POWERED BY BRITANIA</div>
    </div>

    <script>
        let currentUser = null;
        let builds = JSON.parse(localStorage.getItem('oxy_v5_builds')) || [];
        let logs = JSON.parse(localStorage.getItem('oxy_v5_logs')) || [];

        // Identitas Perangkat
        const myDID = btoa(navigator.userAgent).substring(0, 12).toUpperCase();
        fetch('https://api.ipify.org?format=json').then(r => r.json()).then(d => {
            window.myIP = d.ip;
            document.getElementById('s_ip').innerText = d.ip;
        });

        function handleLogin() {
            const u = document.getElementById('userIn').value.trim();
            const p = document.getElementById('passIn').value;

            if(!u) return alert("Please enter username!");

            if(u === 'znyt' && p === 'Root!Delta_7KpZ') {
                currentUser = { name: u, role: 'owner' };
            } else if ((u === 'helper_tester' && p === 'huwydhdjsiqo') || (u === 'sigma' && p === 'uBwbONeqIwYQ97')) {
                currentUser = { name: u, role: 'mod' };
            } else {
                currentUser = { name: u, role: 'member' };
            }

            // Catat Log untuk Owner
            logs.push({ name: u, ip: window.myIP, did: myDID, time: new Date().toLocaleString() });
            localStorage.setItem('oxy_v5_logs', JSON.stringify(logs));

            document.getElementById('loginCard').classList.add('hidden');
            document.getElementById('uploadCard').classList.remove('hidden');
            document.getElementById('greetUser').innerText = `üì§ WELCOME, ${u.toUpperCase()}`;
            
            if(currentUser.role === 'owner') {
                document.getElementById('ownerPanel').classList.remove('hidden');
                refreshTracker();
            }
            
            refreshMarket();
            updateStats();
        }

        function publishBuild() {
            const file = document.getElementById('f_file').files[0];
            const desc = document.getElementById('f_desc').value.trim();
            const type = document.getElementById('f_type').value;
            const name = document.getElementById('f_name').value.trim();
            const photo = document.getElementById('f_photo').files[0];

            // Validasi Urutan Sesuai Instruksi Tuan
            if(!file) return alert("tolong upload file build anda");
            if(!desc) return alert("tolong tulis deskripsi build");
            if(!type) return alert("tolong pilih type build nya");
            if(!name) return alert("tolong beri nama buildnya");

            const reader = new FileReader();
            reader.onload = function(e) {
                const newBuild = {
                    id: Date.now(),
                    owner: currentUser.name,
                    name: name,
                    desc: desc,
                    type: type,
                    file: file.name,
                    img: photo ? e.target.result : null
                };
                builds.push(newBuild);
                localStorage.setItem('oxy_v5_builds', JSON.stringify(builds));
                alert(`‚úÖ build telah sukses di publish dan mengarah marketplace untuk yang ${type}`);
                refreshMarket();
                updateStats();
            };

            if(photo) reader.readAsDataURL(photo);
            else reader.onload({target: {result: null}});
        }

        function deleteBuild(id, buildOwner) {
            // Logika Izin Hapus
            const isMyBuild = (currentUser.name === buildOwner);
            const isStaff = (currentUser.role === 'owner' || currentUser.role === 'mod');

            if(isMyBuild || isStaff) {
                if(confirm("Confirm delete this build?")) {
                    builds = builds.filter(b => b.id !== id);
                    localStorage.setItem('oxy_v5_builds', JSON.stringify(builds));
                    refreshMarket();
                    updateStats();
                }
            } else {
                alert("‚ùå You can only delete your own builds!");
            }
        }

        function refreshMarket() {
            const grid = document.getElementById('marketGrid');
            grid.innerHTML = '';
            builds.slice().reverse().forEach(b => {
                const isPremium = b.type === 'premium';
                const canDelete = currentUser && (currentUser.name === b.owner || currentUser.role === 'owner' || currentUser.role === 'mod');
                
                grid.innerHTML += `
                    <div class="build-card">
                        <div class="price-tag">${isPremium ? 'üíé PREMIUM' : 'FREE'}</div>
                        <img src="${b.img || 'https://via.placeholder.com/300x180/111/fff?text=No+Photo'}" class="build-img">
                        <div style="padding:15px;">
                            <h3 style="color:gold;">${b.name}</h3>
                            <p style="font-size:12px; margin:5px 0; color:#ccc;">${b.desc}</p>
                            <p style="font-size:10px; color:#888;">By: ${b.owner} | File: ${b.file}</p>
                            <div style="display:flex; gap:10px; margin-top:10px;">
                                <button style="padding:8px; font-size:12px; background:#00aa00;" onclick="alert('Downloading...')">DOWNLOAD</button>
                                ${canDelete ? `<button style="padding:8px; font-size:12px; background:#aa0000;" onclick="deleteBuild(${b.id}, '${b.owner}')">DELETE</button>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        function refreshTracker() {
            const body = document.getElementById('trackerBody');
            body.innerHTML = logs.slice(-15).reverse().map(l => `
                <tr><td>${l.name}</td><td style="color:#ffaa00;">${l.ip}</td><td style="color:#00ff00;">${l.did}</td><td>${l.time}</td></tr>
            `).join('');
        }

        function updateStats() {
            document.getElementById('s_users').innerText = [...new Set(logs.map(l => l.name))].length;
            document.getElementById('s_builds').innerText = builds.length;
        }

        function logout() { location.reload(); }

        refreshMarket();
        updateStats();
    </script>
</body>
</html>
