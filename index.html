<!DOCTYPE html>
<html>
<head>
    <title>OXYX MARKET - FINAL</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI',Arial,sans-serif; }
        body { background:#0a0a0a; color:white; padding:20px; }
        .container { max-width:1400px; margin:0 auto; }
        
        /* 3D EFFECTS */
        h1 { font-size:4em; text-align:center; color:#b300ff; text-shadow:3px 3px 0 #ff00ff,-3px -3px 0 #00ffff; animation:glitch 3s infinite; }
        @keyframes glitch { 0%,100%{transform:skew(0deg)} 5%{transform:skew(5deg)} 10%{transform:skew(-5deg)} }
        
        .card { background:#1a1a2a; border:2px solid #b300ff; border-radius:15px; padding:20px; margin-bottom:20px; transform:translateZ(20px); transition:0.3s; }
        .card:hover { transform:translateZ(30px) scale(1.02); box-shadow:0 0 40px #b300ff; }
        
        /* STATS */
        .stats { display:grid; grid-template-columns:repeat(4,1fr); gap:15px; margin:20px 0; }
        .stat-card { background:#2a0a3a; border:2px solid gold; border-radius:10px; padding:15px; text-align:center; }
        .stat-value { font-size:2.5em; color:gold; }
        .online-dot { display:inline-block; width:10px; height:10px; background:#00ff00; border-radius:50%; animation:pulse 2s infinite; }
        @keyframes pulse { 0%{opacity:1} 50%{opacity:0.5;transform:scale(1.3)} }
        
        /* DEVICE INFO - SEMBUNYI UNTUK MEMBER */
        #deviceInfoSection { display:none; }
        .admin-device { background:#0a0a1a; padding:10px; border-radius:5px; font-family:monospace; }
        .device-id { color:#00ff00; }
        .ip-addr { color:#ffaa00; }
        
        /* LOGIN */
        .login-grid { display:grid; grid-template-columns:1fr 1fr; gap:20px; }
        input { width:100%; padding:12px; margin:8px 0; background:#2a2a3a; border:2px solid #b300ff; border-radius:5px; color:white; }
        button { width:100%; padding:15px; background:#b300ff; border:none; border-radius:5px; color:white; font-weight:bold; cursor:pointer; }
        button:hover { background:#d400ff; }
        
        /* IP TABLE */
        .ip-table { width:100%; border-collapse:collapse; margin-top:15px; }
        .ip-table th { background:#b300ff; padding:12px; text-align:left; }
        .ip-table td { padding:10px; border-bottom:1px solid #333; }
        .online { color:#00ff00; }
        .offline { color:#666; }
        
        /* ACTIVE SESSION */
        .session-warning { background:#aa0000; padding:10px; border-radius:5px; text-align:center; }
        
        .hidden { display:none !important; }
        .footer { text-align:center; color:#666; margin-top:30px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚ö° OXYX MARKET 3D ‚ö°</h1>
        
        <!-- STATS -->
        <div class="stats">
            <div class="stat-card"><div class="stat-value" id="totalMembers">0</div><div>Total Members</div></div>
            <div class="stat-card"><div class="stat-value" id="onlineNow">0</div><div><span class="online-dot"></span> Online 24h</div></div>
            <div class="stat-card"><div class="stat-value" id="totalBuilds">0</div><div>Total Builds</div></div>
            <div class="stat-card"><div class="stat-value" id="totalIPs">0</div><div>Unique IPs</div></div>
        </div>
        
        <!-- DEVICE INFO (HANYA UNTUK MOD/OWNER) -->
        <div id="deviceInfoSection" class="card">
            <h2>üì± DEVICE INFO</h2>
            <div class="admin-device">
                <p>Device ID: <span class="device-id" id="deviceId">Loading...</span></p>
                <p>IP Address: <span class="ip-addr" id="ipAddress">Loading...</span></p>
            </div>
        </div>
        
        <!-- LOGIN SECTION -->
        <div class="card">
            <h2>üîê LOGIN</h2>
            <div class="login-grid">
                <div>
                    <h3>üë§ MEMBER</h3>
                    <input type="text" id="memberUsername" placeholder="Username">
                    <button onclick="loginMember()">LOGIN MEMBER</button>
                </div>
                <div>
                    <h3>üëë ADMIN</h3>
                    <input type="text" id="adminUser" placeholder="Username">
                    <input type="password" id="adminPass" placeholder="Password">
                    <button onclick="loginAdmin()">LOGIN ADMIN</button>
                </div>
            </div>
            
            <!-- SESSION WARNING -->
            <div id="sessionWarning" class="session-warning hidden">
                ‚ö†Ô∏è Account ini sudah aktif di device lain! Tidak bisa login.
            </div>
            
            <!-- USER INFO -->
            <div id="userInfo" class="hidden" style="margin-top:20px; padding:15px; background:#2a0a3a; border-radius:10px;">
                <p>Logged in as: <span id="displayName"></span></p>
                <button onclick="logout()" style="background:#aa0000;">LOGOUT</button>
            </div>
        </div>
        
        <!-- IP TABLE (OWNER ONLY) -->
        <div id="ipTableSection" class="card hidden">
            <h2>üëë IP TRACKER - 24 JAM</h2>
            <table class="ip-table">
                <thead><tr><th>Username</th><th>IP</th><th>Device ID</th><th>Last Seen</th><th>Status</th></tr></thead>
                <tbody id="ipTableBody"></tbody>
            </table>
        </div>
        
        <!-- MOD CHAT -->
        <div id="chatSection" class="card hidden">
            <h2>üí¨ MOD CHAT</h2>
            <div id="chatMessages" style="height:150px; overflow:auto; background:#0a0a1a; padding:10px; margin:10px 0;"></div>
            <input type="text" id="chatMsg" placeholder="Type message...">
            <button onclick="sendChat()">SEND</button>
        </div>
        
        <!-- UPLOAD -->
        <div id="uploadSection" class="card hidden">
            <h2>üì§ UPLOAD BUILD</h2>
            <input type="text" id="buildName" placeholder="Build name">
            <input type="number" id="buildPrice" min="0" value="0" placeholder="Price (100+ = premium)">
            <textarea id="buildDesc" rows="3" placeholder="Description"></textarea>
            <input type="file" id="buildFile" accept=".build">
            <button onclick="uploadBuild()">PUBLISH</button>
        </div>
        
        <!-- MARKETPLACE -->
        <div class="card">
            <h2>üè™ MARKETPLACE</h2>
            <div style="display:flex; gap:10px; margin:15px 0; flex-wrap:wrap;">
                <button onclick="filterBuilds('all')">üìã ALL</button>
                <button onclick="filterBuilds('free')">üÜì FREE</button>
                <button onclick="filterBuilds('premium')">üíé PREMIUM</button>
                <button onclick="filterBuilds('my')">üë§ MY BUILDS</button>
            </div>
            <div id="marketplace" style="display:grid; grid-template-columns:repeat(auto-fill,minmax(250px,1fr)); gap:15px;"></div>
        </div>
        
        <div class="footer">OXYX MARKET ‚Ä¢ 1 Device 1 Account ‚Ä¢ 24h IP Tracking</div>
    </div>
    
    <script>
        // ========== DATA ==========
        let currentUser = null;
        let currentFilter = 'all';
        let deviceId = 'DEVICE-' + Math.random().toString(36).substring(2,10).toUpperCase();
        let clientIP = '0.0.0.0';
        
        // ACTIVE SESSIONS - 1 ACCOUNT 1 DEVICE
        let activeSessions = JSON.parse(localStorage.getItem('activeSessions')) || {};
        
        let members = JSON.parse(localStorage.getItem('members')) || [];
        let builds = JSON.parse(localStorage.getItem('builds')) || [
            {id:1, name:"Dragon Boat", price:0, desc:"Cool dragon boat", file:"dragon.build", seller:"znyt"},
            {id:2, name:"Flying Ship", price:150, desc:"Flying ship", file:"flying.build", seller:"helper_tester"},
            {id:3, name:"Golden Raft", price:200, desc:"Golden raft", file:"golden.build", seller:"sigma"}
        ];
        let chats = JSON.parse(localStorage.getItem('chats')) || [{user:"znyt",role:"owner",msg:"Welcome!"}];
        
        // ========== DEVICE & IP ==========
        fetch('https://httpbin.org/ip')
            .then(res => res.json())
            .then(data => { clientIP = data.origin; document.getElementById('ipAddress').innerText = clientIP; })
            .catch(() => { clientIP = '127.0.0.1'; document.getElementById('ipAddress').innerText = clientIP; });
        
        document.getElementById('deviceId').innerText = deviceId;
        
        // ========== CHECK SESSION ==========
        function checkSession(username) {
            if (activeSessions[username] && activeSessions[username] !== deviceId) {
                document.getElementById('sessionWarning').classList.remove('hidden');
                return true;
            }
            return false;
        }
        
        function setSession(username) {
            activeSessions[username] = deviceId;
            localStorage.setItem('activeSessions', JSON.stringify(activeSessions));
        }
        
        function clearSession(username) {
            delete activeSessions[username];
            localStorage.setItem('activeSessions', JSON.stringify(activeSessions));
        }
        
        // ========== LOGIN ==========
        window.loginMember = function() {
            let user = document.getElementById('memberUsername').value.trim();
            if (!user) { alert('Masukin nama!'); return; }
            
            if (checkSession(user)) { alert('‚ùå Account sedang digunakan di device lain!'); return; }
            
            let now = new Date().toISOString();
            let existing = members.find(m => m.username === user);
            
            if (existing) {
                existing.lastSeen = now;
                existing.loginCount = (existing.loginCount || 0) + 1;
            } else {
                members.push({
                    username: user, ip: clientIP, deviceId: deviceId,
                    firstSeen: now, lastSeen: now, loginCount: 1
                });
            }
            
            setSession(user);
            localStorage.setItem('members', JSON.stringify(members));
            
            currentUser = { username: user, role: 'member' };
            showUserInfo();
            alert('‚úÖ Welcome ' + user);
        };
        
        window.loginAdmin = function() {
            let user = document.getElementById('adminUser').value.trim();
            let pass = document.getElementById('adminPass').value.trim();
            
            // CEK SESSION DULU
            if (checkSession(user)) { 
                document.getElementById('sessionWarning').classList.remove('hidden');
                alert('‚ùå Account sedang digunakan di device lain!');
                return; 
            }
            
            if (user === 'znyt' && pass === 'Root!Delta_7KpZ') {
                currentUser = { username: 'znyt', role: 'owner' };
                setSession('znyt');
                showUserInfo();
                document.getElementById('ipTableSection').classList.remove('hidden');
                document.getElementById('deviceInfoSection').style.display = 'block';
                updateIpTable();
                alert('‚úÖ Welcome OWNER');
            }
            else if (user === 'helper_tester' && pass === 'huwydhdjsiqo') {
                currentUser = { username: 'helper_tester', role: 'mod' };
                setSession('helper_tester');
                showUserInfo();
                document.getElementById('chatSection').classList.remove('hidden');
                document.getElementById('deviceInfoSection').style.display = 'block';
                alert('‚úÖ Welcome MOD 1');
            }
            else if (user === 'sigma' && pass === 'uBwbONeqIwYQ97') {
                currentUser = { username: 'sigma', role: 'mod' };
                setSession('sigma');
                showUserInfo();
                document.getElementById('chatSection').classList.remove('hidden');
                document.getElementById('deviceInfoSection').style.display = 'block';
                alert('‚úÖ Welcome MOD 2');
            }
            else {
                alert('‚ùå Wrong credentials');
            }
        };
        
        function showUserInfo() {
            document.getElementById('userInfo').classList.remove('hidden');
            document.getElementById('displayName').innerText = currentUser.username + ' (' + currentUser.role + ')';
            document.getElementById('uploadSection').classList.remove('hidden');
            if (currentUser.role === 'owner' || currentUser.role === 'mod') {
                document.getElementById('chatSection').classList.remove('hidden');
                displayChat();
            }
        }
        
        window.logout = function() {
            if (currentUser) {
                clearSession(currentUser.username);
            }
            currentUser = null;
            document.getElementById('userInfo').classList.add('hidden');
            document.getElementById('uploadSection').classList.add('hidden');
            document.getElementById('chatSection').classList.add('hidden');
            document.getElementById('ipTableSection').classList.add('hidden');
            document.getElementById('deviceInfoSection').style.display = 'none';
            document.getElementById('sessionWarning').classList.add('hidden');
            alert('Logged out');
        };
        
        // ========== STATS ==========
        function updateStats() {
            document.getElementById('totalMembers').innerText = members.length;
            document.getElementById('totalBuilds').innerText = builds.length;
            
            let last24h = Date.now() - 86400000;
            let online = members.filter(m => new Date(m.lastSeen).getTime() > last24h).length;
            document.getElementById('onlineNow').innerText = online;
            
            let uniqueIPs = [...new Set(members.map(m => m.ip))].length;
            document.getElementById('totalIPs').innerText = uniqueIPs;
        }
        
        // ========== IP TABLE ==========
        function updateIpTable() {
            let tbody = document.getElementById('ipTableBody');
            if (members.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5">Belum ada member</td></tr>';
                return;
            }
            
            let html = '';
            let last24h = Date.now() - 86400000;
            
            members.sort((a,b) => new Date(b.lastSeen) - new Date(a.lastSeen)).forEach(m => {
                let isOnline = new Date(m.lastSeen).getTime() > last24h;
                let status = isOnline ? '<span class="online">üü¢ ONLINE (24h)</span>' : '<span class="offline">‚ö´ OFFLINE</span>';
                
                html += `
                    <tr>
                        <td><b>${m.username}</b></td>
                        <td>${m.ip || 'Unknown'}</td>
                        <td>${(m.deviceId || '').substring(0,15)}...</td>
                        <td>${new Date(m.lastSeen).toLocaleString()}</td>
                        <td>${status}</td>
                    </tr>
                `;
            });
            tbody.innerHTML = html;
        }
        
        // ========== CHAT ==========
        window.sendChat = function() {
            if (!currentUser || currentUser.role === 'member') {
                alert('Only mods can chat');
                return;
            }
            let msg = document.getElementById('chatMsg').value.trim();
            if (!msg) return;
            
            chats.push({ user: currentUser.username, role: currentUser.role, msg: msg });
            localStorage.setItem('chats', JSON.stringify(chats));
            document.getElementById('chatMsg').value = '';
            displayChat();
        };
        
        function displayChat() {
            let box = document.getElementById('chatMessages');
            let html = '';
            chats.slice(-10).forEach(c => {
                let color = c.role === 'owner' ? 'gold' : '#00ff00';
                html += `<div style="padding:5px; border-bottom:1px solid #333;">
                    <span style="color:${color}">${c.role==='owner'?'üëë':'üõ°Ô∏è'} ${c.user}:</span> ${c.msg}
                </div>`;
            });
            box.innerHTML = html;
        }
        
        // ========== UPLOAD ==========
        window.uploadBuild = function() {
            if (!currentUser) { alert('Login dulu!'); return; }
            
            let name = document.getElementById('buildName').value.trim();
            let price = parseInt(document.getElementById('buildPrice').value) || 0;
            let desc = document.getElementById('buildDesc').value.trim();
            let file = document.getElementById('buildFile').files[0];
            
            if (!name || !desc || !file) { alert('Isi semua!'); return; }
            
            builds.push({
                id: Date.now(),
                name: name, price: price, desc: desc,
                file: file.name, seller: currentUser.username
            });
            localStorage.setItem('builds', JSON.stringify(builds));
            alert('‚úÖ Upload berhasil');
            displayBuilds();
            updateStats();
        };
        
        window.deleteBuild = function(id, seller) {
            if (!currentUser) { alert('Login dulu!'); return; }
            if (currentUser.role === 'owner' || currentUser.role === 'mod' || currentUser.username === seller) {
                builds = builds.filter(b => b.id !== id);
                localStorage.setItem('builds', JSON.stringify(builds));
                displayBuilds();
                updateStats();
                alert('‚úÖ Build dihapus');
            } else {
                alert('‚ùå Ga boleh hapus punya orang');
            }
        };
        
        window.downloadBuild = function(file) { alert('üì• Download ' + file); };
        
        // ========== FILTER ==========
        window.filterBuilds = function(filter) {
            currentFilter = filter;
            displayBuilds();
        };
        
        function displayBuilds() {
            let filtered = builds;
            
            if (currentFilter === 'free') filtered = builds.filter(b => b.price === 0);
            else if (currentFilter === 'premium') filtered = builds.filter(b => b.price >= 100);
            else if (currentFilter === 'my') {
                if (!currentUser) { document.getElementById('marketplace').innerHTML = '<p>Login untuk lihat buildmu</p>'; return; }
                filtered = builds.filter(b => b.seller === currentUser.username);
            }
            
            if (filtered.length === 0) { document.getElementById('marketplace').innerHTML = '<p>No builds</p>'; return; }
            
            let html = '';
            filtered.reverse().forEach(b => {
                let canDelete = currentUser && (currentUser.role === 'owner' || currentUser.role === 'mod' || currentUser.username === b.seller);
                let isPremium = b.price >= 100;
                
                html += `
                    <div style="background:#2a2a3a; border:2px solid ${isPremium?'gold':'#b300ff'}; border-radius:10px; padding:15px;">
                        <h3>${b.name}</h3>
                        <p style="color:gold;">üí∞ ${b.price} Robux</p>
                        <p>${b.desc}</p>
                        <p>üì¶ ${b.file}</p>
                        <p>Seller: ${b.seller}</p>
                        <button style="width:100%; padding:10px; background:#00aa00; border:none; color:white; border-radius:5px; margin:5px 0;" onclick="downloadBuild('${b.file}')">‚¨áÔ∏è DOWNLOAD</button>
                        ${canDelete ? `<button style="width:100%; padding:10px; background:#aa0000; border:none; color:white; border-radius:5px;" onclick="deleteBuild(${b.id}, '${b.seller}')">üóëÔ∏è DELETE</button>` : ''}
