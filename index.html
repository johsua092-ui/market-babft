<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OXYX MARKET</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Arial, sans-serif; }
        body { background: #0a0a0a; color: white; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { color: #b87cff; text-align: center; margin-bottom: 30px; border-bottom: 2px solid #9f4dff; padding-bottom: 10px; }
        .card { background: #1a1a2a; border: 2px solid #9f4dff; border-radius: 10px; padding: 20px; margin-bottom: 20px; }
        .discord-container { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin: 20px 0; }
        .discord-btn { padding: 10px 20px; border-radius: 5px; text-decoration: none; color: white; font-weight: bold; }
        .discord-btn.main { background: #5865F2; }
        .discord-btn.support { background: #57F287; }
        .key-section { display: flex; gap: 10px; max-width: 500px; margin: 20px auto; }
        .key-section input { flex: 1; padding: 12px; background: #2a2a3a; border: 2px solid #9f4dff; border-radius: 5px; color: white; }
        .key-section button { padding: 12px 20px; background: #9f4dff; border: none; border-radius: 5px; color: white; font-weight: bold; cursor: pointer; }
        .status { padding: 10px; border-radius: 5px; margin: 10px 0; display: none; }
        .success { background: #1a3a1a; color: #8aff8a; border: 1px solid #00aa00; }
        .error { background: #3a1a1a; color: #ff8a8a; border: 1px solid #aa0000; }
        .chat-box { background: #0a0a1a; border: 2px solid #9f4dff; border-radius: 5px; padding: 15px; height: 200px; overflow-y: auto; margin-bottom: 15px; }
        .upload-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .upload-item { margin-bottom: 10px; }
        .upload-item label { display: block; color: #b87cff; margin-bottom: 5px; }
        .upload-item input, .upload-item select, .upload-item textarea { width: 100%; padding: 10px; background: #2a2a3a; border: 2px solid #9f4dff; border-radius: 5px; color: white; }
        .image-preview { width: 100%; height: 150px; border: 2px dashed #9f4dff; border-radius: 5px; display: flex; align-items: center; justify-content: center; color: #666; margin-top: 10px; overflow: hidden; }
        .publish-btn { width: 100%; padding: 15px; background: #9f4dff; border: none; border-radius: 5px; color: white; font-size: 1.2em; font-weight: bold; cursor: pointer; margin-top: 15px; }
        .sort-section { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .sort-btn { padding: 8px 16px; background: #2a2a3a; border: 2px solid #9f4dff; border-radius: 5px; color: white; cursor: pointer; }
        .sort-btn.active { background: #9f4dff; }
        .build-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }
        .build-card { background: #2a2a3a; border: 2px solid #9f4dff; border-radius: 5px; padding: 15px; }
        .build-card.free { border-color: #00ff00; }
        .build-card.premium { border-color: gold; }
        .build-image { width: 100%; height: 150px; border-radius: 5px; overflow: hidden; margin-bottom: 10px; }
        .build-image img { width: 100%; height: 100%; object-fit: cover; }
        .build-price { font-size: 1.2em; font-weight: bold; margin: 10px 0; }
        .free .build-price { color: #00ff00; }
        .premium .build-price { color: gold; }
        .download-btn { background: #9f4dff; color: white; border: none; padding: 8px; border-radius: 3px; cursor: pointer; margin: 10px 0; }
        .footer { text-align: center; color: #888; margin-top: 30px; padding-top: 20px; border-top: 1px solid #333; }
    </style>
</head>
<body>
    <div class="container">
        <h1>OXYX MARKET</h1>

        <div class="discord-container">
            <a href="https://discord.gg/autobuild" target="_blank" class="discord-btn main">MAIN SERVER</a>
            <a href="https://discord.gg/boatbuilderhub" target="_blank" class="discord-btn support">SUPPORT 1</a>
            <a href="https://discord.gg/boatbuilderhub" target="_blank" class="discord-btn support">SUPPORT 2</a>
        </div>

        <div class="key-section">
            <input type="password" id="keyInput" placeholder="Masukkan key">
            <button onclick="activateKey()">AKTIVASI</button>
        </div>
        <div id="keyStatus" class="status"></div>

        <div id="modSection" style="display: none;" class="card">
            <h2>üí¨ MOD SERVER</h2>
            <div class="chat-box" id="chatMessages"></div>
            <div style="display: flex; gap: 10px;">
                <input type="text" id="chatInput" placeholder="Ketik pesan..." style="flex:1; padding:10px;">
                <button onclick="sendChat()">KIRIM</button>
            </div>
        </div>

        <div class="card">
            <h2>üì§ UPLOAD BUILD</h2>
            <div class="upload-grid">
                <div class="upload-item">
                    <label>Nama Build</label>
                    <input type="text" id="buildName" placeholder="Contoh: Flying Dragon">
                </div>
                <div class="upload-item">
                    <label>Tipe</label>
                    <select id="buildType">
                        <option value="">Pilih</option>
                        <option value="Ship">üö¢ Ship</option>
                        <option value="Plane">‚úàÔ∏è Plane</option>
                        <option value="Mech">ü§ñ Mech</option>
                        <option value="Vehicle">üöó Vehicle</option>
                    </select>
                </div>
                <div class="upload-item">
                    <label>Harga (Robux)</label>
                    <input type="number" id="buildPrice" min="0" value="0">
                </div>
                <div class="upload-item">
                    <label>Foto Build</label>
                    <input type="file" id="buildImage" accept="image/*" onchange="previewImage(event)">
                    <div class="image-preview" id="imagePreview">
                        <span>Preview foto</span>
                    </div>
                </div>
                <div class="upload-item" style="grid-column: span 2;">
                    <label>Deskripsi</label>
                    <textarea id="buildDesc" rows="3" placeholder="Detail build..."></textarea>
                </div>
                <div class="upload-item" style="grid-column: span 2;">
                    <label>File Build (.build)</label>
                    <input type="file" id="buildFile" accept=".build">
                </div>
            </div>
            <button class="publish-btn" onclick="publishBuild()">üöÄ PUBLISH</button>
            <div id="uploadStatus" class="status"></div>
        </div>

        <div class="sort-section">
            <button class="sort-btn active" onclick="sortBuilds('all')">üìã Semua</button>
            <button class="sort-btn" onclick="sortBuilds('free')">üÜì Gratis (0 Robux)</button>
            <button class="sort-btn" onclick="sortBuilds('premium')">üíé Premium (90-100 Robux)</button>
        </div>

        <div class="card">
            <h2>üè™ MARKETPLACE</h2>
            <div id="marketplace" class="build-grid">Loading...</div>
        </div>

        <div class="footer">
            <p>OXYX MARKET ‚Ä¢ 1 Key 1 Device</p>
        </div>
    </div>

    <script>
        const API_KEY = '$2a$10$RYz0R2fKkR23Gf1qGguLi.5Tlr.5UlfHymp1bYXB5Zhp352m4fdua';
        const BIN_ID = '69a24d2a43b1c97be9a53651';
        
        let isMod = false;
        let currentUser = '';
        let builds = [];
        let chats = [];
        let currentFilter = 'all';
        let deviceId = '';
        
        function generateDeviceId() {
            const components = [navigator.userAgent, screen.width, screen.height, navigator.language];
            let str = components.join('|');
            let id = '';
            for (let i = 0; i < str.length; i++) id += str.charCodeAt(i).toString(16);
            return id.substring(0, 20);
        }
        
        deviceId = generateDeviceId();
        let keyDevices = JSON.parse(localStorage.getItem('keyDevices')) || {};
        
        async function loadData() {
            try {
                const response = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
                    headers: { 'X-Access-Key': API_KEY }
                });
                const data = await response.json();
                builds = data.record.builds || [];
                chats = data.record.chats || [];
                displayBuilds();
                displayChats();
            } catch (error) { console.error('Error:', error); }
        }
        
        async function saveData() {
            try {
                await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json', 'X-Access-Key': API_KEY },
                    body: JSON.stringify({ builds, chats })
                });
                return true;
            } catch (error) { return false; }
        }
        
        function activateKey() {
            const key = document.getElementById('keyInput').value.toLowerCase().trim();
            const validKeys = ['owner', 'mod1', 'mod2'];
            
            if (!validKeys.includes(key)) {
                showStatus('keyStatus', '‚ùå Key salah!', 'error'); return;
            }
            
            if (keyDevices[deviceId] && keyDevices[deviceId] !== key) {
                showStatus('keyStatus', '‚ùå Device ini sudah terdaftar dengan key berbeda!', 'error'); return;
            }
            
            for (let id in keyDevices) {
                if (keyDevices[id] === key && id !== deviceId) {
                    showStatus('keyStatus', '‚ùå Key sudah digunakan di device lain!', 'error'); return;
                }
            }
            
            keyDevices[deviceId] = key;
            localStorage.setItem('keyDevices', JSON.stringify(keyDevices));
            
            isMod = true;
            currentUser = key;
            document.getElementById('modSection').style.display = 'block';
            showStatus('keyStatus', '‚úÖ Key valid! Selamat datang ' + key, 'success');
            displayChats();
        }
        
        function previewImage(event) {
            const preview = document.getElementById('imagePreview');
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => preview.innerHTML = `<img src="${e.target.result}" style="width:100%; height:100%; object-fit:cover;">`;
                reader.readAsDataURL(file);
            } else preview.innerHTML = '<span>Preview foto</span>';
        }
        
        async function publishBuild() {
            const name = document.getElementById('buildName').value.trim();
            const type = document.getElementById('buildType').value;
            const price = parseInt(document.getElementById('buildPrice').value);
            const desc = document.getElementById('buildDesc').value.trim();
            const imageFile = document.getElementById('buildImage').files[0];
            const buildFile = document.getElementById('buildFile').files[0];
            
            if (!name || !type || !desc || !imageFile || !buildFile) {
                showStatus('uploadStatus', '‚ùå Semua harus diisi!', 'error'); return;
            }
            if (!buildFile.name.toLowerCase().endsWith('.build')) {
                showStatus('uploadStatus', '‚ùå File harus .build!', 'error'); return;
            }
            
            showStatus('uploadStatus', '‚è´ Uploading...', 'info');
            
            try {
                const imageData = await readFileAsBase64(imageFile);
                const buildData = await readFileAsBase64(buildFile);
                
                builds.push({
                    id: Date.now(), name, type, price, desc,
                    image: imageData, fileName: buildFile.name, fileData: buildData,
                    seller: isMod ? currentUser : 'Guest', waktu: new Date().toLocaleString('id-ID')
                });
                
                if (await saveData()) {
                    ['buildName','buildType','buildDesc','buildImage','buildFile'].forEach(id => {
                        document.getElementById(id).value = '';
                    });
                    document.getElementById('buildPrice').value = '0';
                    document.getElementById('imagePreview').innerHTML = '<span>Preview foto</span>';
                    showStatus('uploadStatus', '‚úÖ Build dipublish!', 'success');
                    await loadData();
                }
            } catch (error) { showStatus('uploadStatus', '‚ùå Error: ' + error.message, 'error'); }
        }
        
        function readFileAsBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        
        function sortBuilds(filter) {
            currentFilter = filter;
            document.querySelectorAll('.sort-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            displayBuilds();
        }
        
        function displayBuilds() {
            const grid = document.getElementById('marketplace');
            let filtered = [...builds];
            if (currentFilter === 'free') filtered = builds.filter(b => b.price === 0);
            else if (currentFilter === 'premium') filtered = builds.filter(b => b.price >= 90 && b.price <= 100);
            filtered.reverse();
            
            if (filtered.length === 0) {
                grid.innerHTML = '<p style="grid-column:1/-1; text-align:center; color:#666;">Tidak ada build</p>';
                return;
            }
            
            let html = '';
            filtered.forEach(build => {
                const isFree = build.price === 0;
                const isPremium = build.price >= 90 && build.price <= 100;
                let cardClass = isFree ? 'free' : (isPremium ? 'premium' : '');
                
                html += `
                    <div class="build-card ${cardClass}">
                        <div class="build-image"><img src="${build.image || 'https://via.placeholder.com/280x150?text=No+Image'}" alt=""></div>
                        <h3>${escapeHtml(build.name)}</h3>
                        <div>${escapeHtml(build.type)}</div>
                        <div class="build-price">üí∞ ${build.price} Robux</div>
                        <div style="color:#aaa;">${escapeHtml(build.desc.substring(0, 50))}...</div>
                        <button class="download-btn" onclick="downloadBuild('${build.fileData}', '${build.fileName}')">‚¨áÔ∏è Download</button>
                        <div style="color:#666; font-size:0.8em; margin-top:10px;">Seller: ${escapeHtml(build.seller)}</div>
                    </div>
                `;
            });
            grid.innerHTML = html;
        }
        
        function downloadBuild(fileData, fileName) {
            const link = document.createElement('a');
            link.href = fileData;
            link.download = fileName;
            link.click();
        }
        
        function displayChats() {
            const box = document.getElementById('chatMessages');
            if (!box) return;
            if (chats.length === 0) { box.innerHTML = '<p style="color:#666;">Belum ada chat</p>'; return; }
            let html = '';
            chats.forEach(chat => {
                html += `<div class="chat-message"><b style="color:#b87cff;">${escapeHtml(chat.user)}:</b> ${escapeHtml(chat.msg)}<small style="color:#666; float:right;">${chat.time || ''}</small></div>`;
            });
            box.innerHTML = html;
            box.scrollTop = box.scrollHeight;
        }
        
        async function sendChat() {
            if (!isMod) { alert('Aktivasi key dulu!'); return; }
            const msg = document.getElementById('chatInput').value.trim();
            if (!msg) return;
            chats.push({ user: currentUser, msg: msg, time: new Date().toLocaleTimeString('id-ID') });
            await saveData();
            document.getElementById('chatInput').value = '';
            await loadData();
        }
        
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = 'status ' + type;
            element.textContent = message;
            setTimeout(() => element.style.display = 'none', 3000);
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            setInterval(loadData, 5000);
        });
    </script>
</body>
</html>
