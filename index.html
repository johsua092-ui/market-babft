<!DOCTYPE html>
<html>
<head>
    <title>OXYX MARKET | SHADOW EDITION</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Orbitron',monospace; }
        body { 
            background: linear-gradient(135deg, #0a0a0a 0%, #1a0a2a 50%, #0a0a0a 100%);
            color:#e0e0e0; padding:20px; min-height:100vh; position:relative; overflow-x:hidden;
        }
        
        /* Shadow Chain Effects */
        .chain-left, .chain-right {
            position: fixed; top: 0; width: 50px; height: 100vh; z-index: 1000; opacity: 0.4;
            background: repeating-linear-gradient(0deg, #333 0px, #333 15px, #666 15px, #666 30px);
            animation: chainMove 3s ease-in-out infinite;
        }
        .chain-left { left: 0; }
        .chain-right { right: 0; animation-direction: reverse; }
        @keyframes chainMove { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-20px); } }
        
        .container { max-width:1400px; margin:0 auto; position:relative; z-index:10; }
        
        h1 { 
            font-size:4.5em; text-align:center; font-weight:900; margin-bottom:20px;
            background: linear-gradient(45deg, #b300ff, #ff00ff, #00ffff, #b300ff);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            animation: shadowPulse 2s ease-in-out infinite;
        }
        @keyframes shadowPulse { 0%, 100% { text-shadow: 0 0 30px rgba(179,0,255,0.5); } 50% { text-shadow: 0 0 50px rgba(179,0,255,0.8); } }
        
        .powered-by { text-align:center; font-size:0.9em; color:#666; margin-bottom:30px; font-style:italic; }
        
        .card { 
            background: linear-gradient(145deg, #1a1a2a, #2a1a3a); border:2px solid #b300ff; border-radius:20px; 
            padding:25px; margin-bottom:25px; position:relative; backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(179,0,255,0.3), inset 0 1px 0 rgba(255,255,255,0.1);
            transform: perspective(1000px) rotateX(2deg); transition: all 0.3s ease;
        }
        .card:hover { transform: perspective(1000px) rotateX(0deg) translateY(-5px); box-shadow: 0 15px 40px rgba(179,0,255,0.4); }
        .card::before {
            content:''; position:absolute; top:-2px; left:-2px; right:-2px; bottom:-2px;
            background: linear-gradient(45deg, #b300ff, #ff00ff, #00ffff, #b300ff);
            border-radius:22px; z-index:-1; opacity:0.7; animation: borderGlow 3s ease-in-out infinite;
        }
        @keyframes borderGlow { 0%, 100% { opacity: 0.7; } 50% { opacity: 1; } }
        
        .stats { display:grid; grid-template-columns:repeat(3,1fr); gap:20px; margin:25px 0; }
        .stat-card { 
            background: linear-gradient(145deg, #2a0a3a, #3a1a4a); border:2px solid gold; border-radius:15px; 
            padding:20px; text-align:center; box-shadow: 0 4px 20px rgba(255,215,0,0.3);
            transition: transform 0.3s ease; transform: perspective(800px) rotateY(-5deg);
        }
        .stat-card:hover { transform: perspective(800px) rotateY(0deg) translateY(-8px); }
        .stat-value { font-size:3em; color:gold; font-weight:900; text-shadow: 0 0 20px rgba(255,215,0,0.5); }
        
        .login-grid { display:grid; grid-template-columns:1fr 1fr; gap:25px; }
        input, textarea, select { 
            width:100%; padding:15px; margin:10px 0; color:#e0e0e0; font-family:'Orbitron',monospace;
            background: linear-gradient(145deg, #2a2a3a, #3a3a4a); border:2px solid #b300ff; border-radius:10px;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.3); transition: all 0.3s ease;
        }
        input:focus, textarea:focus { border-color:#ff00ff; box-shadow: 0 0 20px rgba(255,0,255,0.3); outline:none; transform: translateY(-2px); }
        
        button { 
            width:100%; padding:18px; background: linear-gradient(45deg, #b300ff, #d400ff); border:none; 
            border-radius:10px; color:white; font-weight:bold; cursor:pointer; font-family:'Orbitron',monospace;
            transition: all 0.3s ease; text-transform:uppercase; letter-spacing:1px;
            box-shadow: 0 4px 15px rgba(179,0,255,0.3); transform: perspective(500px) rotateX(10deg);
        }
        button:hover { 
            background: linear-gradient(45deg, #d400ff, #ff00ff);
            transform: perspective(500px) rotateX(0deg) translateY(-3px);
            box-shadow: 0 8px 25px rgba(179,0,255,0.5);
        }
        
        .hidden { display:none !important; }
        .owner-panel { background: linear-gradient(145deg, #1a0a2a, #2a1a3a); border:3px solid gold; }
        .mod-panel { background: linear-gradient(145deg, #1a1a0a, #2a2a1a); border:3px solid #ffaa00; }
        
        /* Discord Links */
        .discord-links { display:flex; gap:15px; justify-content:center; margin:20px 0; flex-wrap:wrap; }
        .discord-btn {
            background: linear-gradient(45deg, #5865F2, #7289DA); padding:12px 25px; border-radius:25px;
            text-decoration:none; color:white; font-weight:bold; transition: all 0.3s ease;
            display:flex; align-items:center; gap:8px; transform: perspective(400px) rotateX(10deg);
        }
        .discord-btn:hover { transform: perspective(400px) rotateX(0deg) translateY(-5px); }
        
        /* FAQ Styles */
        .faq-item { background: linear-gradient(145deg, #2a2a3a, #3a3a4a); margin:10px 0; border-radius:10px; overflow:hidden; }
        .faq-question { padding:15px; background: linear-gradient(45deg, #b300ff, #d400ff); cursor:pointer; font-weight:bold; }
        .faq-answer { padding:15px; display:none; }
        .faq-answer.active { display:block; animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Build Preview */
        .build-preview { max-width:200px; max-height:150px; border-radius:10px; margin:10px 0; border:2px solid #b300ff; }
        .build-card { 
            background: linear-gradient(145deg, #2a2a3a, #3a3a4a); border:2px solid #b300ff; border-radius:15px; 
            padding:20px; transition: all 0.3s ease; transform: perspective(600px) rotateY(5deg);
        }
        .build-card:hover { transform: perspective(600px) rotateY(0deg) translateY(-8px); }
        .premium-build { border-color:gold; background: linear-gradient(145deg, #3a2a0a, #4a3a1a); }
        
        /* Security Warning */
        .security-warning { 
            position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); 
            z-index:9999; display:flex; align-items:center; justify-content:center;
        }
        .blocked-overlay {
            background: linear-gradient(45deg, #aa0000, #ff0000); padding:40px; border-radius:20px; text-align:center;
            box-shadow: 0 0 50px rgba(255,0,0,0.5); animation: warningPulse 1s ease-in-out infinite;
        }
        @keyframes warningPulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        
        /* Responsive */
        @media (max-width: 768px) {
            .stats { grid-template-columns: 1fr; }
            .login-grid { grid-template-columns: 1fr; }
            .discord-links { flex-direction: column; align-items: center; }
            h1 { font-size: 2.5em; }
            .chain-left, .chain-right { width: 30px; }
        }
    </style>
</head>
<body>
    <!-- Chain Effects -->
    <div class="chain-left"></div>
    <div class="chain-right"></div>
    
    <!-- Security Warning -->
    <div id="securityWarning" class="security-warning hidden">
        <div class="blocked-overlay">
            <h2>üö® SHADOW SECURITY BREACH</h2>
            <p>Unauthorized access detected. System locked.</p>
            <p id="blockMessage">This incident has been logged.</p>
        </div>
    </div>

    <div class="container">
        <h1>‚ö° OXYX MARKET ‚ö°</h1>
        <div class="powered-by">Powered by OxyX ‚Ä¢ Shadow Edition</div>
        
        <!-- Custom Discord Links -->
        <div class="discord-links">
            <a href="https://discord.gg/autobuild" class="discord-btn" target="_blank">üéÆ Main Server</a>
            <a href="https://discord.gg/boatbuilderhub" class="discord-btn" target="_blank">üõ†Ô∏è Support Server</a>
            <a href="https://discord.gg/boatbuilderhub" class="discord-btn" target="_blank">üí¨ Support Server 2</a>
        </div>
        
        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="totalMembers">0</div>
                <div>Total Members</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="onlineNow">0</div>
                <div>Online</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalBuilds">0</div>
                <div>Total Builds</div>
            </div>
        </div>

        <div class="card">
            <h2>üîê SHADOW LOGIN</h2>
            <div id="sessionWarning" class="hidden" style="background:#aa0000; padding:15px; border-radius:10px; text-align:center; margin-bottom:15px;">
                ‚ö†Ô∏è Session active on another device! 
                <button onclick="forceUnbind()" style="width:auto; padding:8px 15px; background:white; color:black; font-size:12px;">FORCE UNBIND</button>
            </div>
            <div class="login-grid" id="loginForm">
                <div>
                    <h3>üë§ MEMBER</h3>
                    <input type="text" id="memberUsername" placeholder="Username">
                    <button onclick="loginMember()">LOGIN MEMBER</button>
                </div>
                <div>
                    <h3>üëë ADMIN</h3>
                    <input type="text" id="adminUser" placeholder="Username">
                    <input type="password" id="adminPass" placeholder="Password">
                    <input type="text" id="whidInput" placeholder="WHID (Required)" style="background:#0a0a0a; border:2px solid gold;">
                    <button onclick="loginAdmin()">LOGIN ADMIN</button>
                </div>
            </div>
            <div id="userInfo" class="hidden" style="margin-top:25px; padding:20px; background:linear-gradient(145deg, #2a0a3a, #3a1a4a); border-radius:15px;">
                <p>Logged in as: <span id="displayName" style="font-weight:bold; color:gold;"></span></p>
                <button onclick="logout()" style="background:linear-gradient(45deg, #aa0000, #ff0000); margin-top:15px;">LOGOUT</button>
            </div>
        </div>

        <!-- Owner Panel -->
        <div id="ownerPanel" class="card owner-panel hidden">
            <h2>üëë SHADOW COMMAND CENTER</h2>
            <div style="margin-bottom:20px;">
                <h4>Reset Moderator Password</h4>
                <select id="modSelect">
                    <option value="">Select Moderator</option>
                    <option value="helper_tester">helper_tester</option>
                    <option value="sigma">sigma</option>
                </select>
                <input type="password" id="newModPass" placeholder="New Password">
                <button onclick="resetModPassword()">RESET PASSWORD</button>
            </div>
        </div>

        <!-- Upload Section -->
        <div id="uploadSection" class="card hidden">
            <h2>üì§ UPLOAD BUILD</h2>
            <input type="text" id="buildName" placeholder="Build name" maxlength="50">
            <input type="number" id="buildPrice" min="0" value="0" placeholder="Price (100+ = premium)">
            <textarea id="buildDesc" rows="3" placeholder="Description" maxlength="200"></textarea>
            <input type="file" id="buildFile" accept=".build" required>
            <input type="file" id="buildImage" accept="image/*" placeholder="Build Preview Image">
            <div id="imagePreview"></div>
            <button onclick="uploadBuild()">PUBLISH BUILD</button>
        </div>

        <!-- Marketplace -->
        <div class="card">
            <h2>üè™ SHADOW MARKETPLACE</h2>
            <div style="display:flex; gap:15px; margin:20px 0; flex-wrap:wrap;">
                <button onclick="filterBuilds('all')">üìã ALL BUILDS</button>
                <button onclick="filterBuilds('free')">üÜì FREE BUILDS</button>
                <button onclick="filterBuilds('premium')">üíé PREMIUM BUILDS</button>
                <button onclick="filterBuilds('my')">üë§ MY BUILDS</button>
            </div>
            <div id="marketplace" style="display:grid; grid-template-columns:repeat(auto-fill,minmax(300px,1fr)); gap:20px;"></div>
        </div>

        <!-- FAQ Section -->
        <div class="card">
            <h2>‚ùì FAQ & BUG REPORT</h2>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:25px;">
                <div>
                    <h3>Frequently Asked Questions</h3>
                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFAQ(0)">How to upload builds?</div>
                        <div class="faq-answer">Only .build files are accepted. Add preview image and description for better visibility.</div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFAQ(1)">What are premium builds?</div>
                        <div class="faq-answer">Builds priced 100+ Robux are premium builds with special highlighting.</div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFAQ(2)">How to download builds?</div>
                        <div class="faq-answer">Click the ‚¨áÔ∏è DOWNLOAD button on any build card. File downloads automatically.</div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFAQ(3)">What is WHID?</div>
                        <div class="faq-answer">WHID is a security identifier required for admin/moderator login.</div>
                    </div>
                </div>
                <div>
                    <h3>Report Bug</h3>
                    <input type="text" id="bugTitle" placeholder="Bug Title" maxlength="100">
                    <textarea id="bugDesc" rows="4" placeholder="Describe the bug" maxlength="500"></textarea>
                    <select id="bugSeverity">
                        <option value="low">Low Priority</option>
                        <option value="medium">Medium Priority</option>
                        <option value="high">High Priority</option>
                        <option value="critical">Critical</option>
                    </select>
                    <button onclick="reportBug()">SUBMIT BUG REPORT</button>
                </div>
            </div>
        </div>

        <div style="text-align:center; color:#666; margin-top:40px; font-size:0.9em;">
            OXYX MARKET ‚Ä¢ Shadow Edition ‚Ä¢ Build A Boat Only<br>
            <span style="font-size:0.8em;">Powered by OxyX ‚Ä¢ Enhanced Security System</span>
        </div>
    </div>

    <script>
        // ========== ENHANCED SECURITY SYSTEM ==========
        let devtoolsOpen = false, securityBreach = false, blockedUntil = localStorage.getItem('blockedUntil');
        let failedAttempts = parseInt(localStorage.getItem('failedAttempts')) || 0;

        // Multi-layer DevTools Detection
        function detectDevTools() {
            let threshold = 160;
            if (window.outerHeight - window.innerHeight > threshold || window.outerWidth - window.innerWidth > threshold) {
                if (!devtoolsOpen) {
                    devtoolsOpen = true;
                    securityBreach = true;
                    handleSecurityBreach('DevTools detected');
                }
            }
        }

        function handleSecurityBreach(reason) {
            failedAttempts++;
            localStorage.setItem('failedAttempts', failedAttempts);
            addLog('SECURITY_BREACH', reason);
            
            if (failedAttempts >= 3) {
                let blockTime = new Date();
                blockTime.setHours(blockTime.getHours() + 24);
                localStorage.setItem('blockedUntil', blockTime.toISOString());
                showBlockedScreen();
            } else {
                document.getElementById('securityWarning').classList.remove('hidden');
                setTimeout(() => window.location.href = 'about:blank', 3000);
            }
        }

        function showBlockedScreen() {
            document.getElementById('securityWarning').classList.remove('hidden');
            document.getElementById('blockMessage').innerText = 'Access blocked for 24 hours due to security violations.';
        }

        // Disable developer access
        document.addEventListener('contextmenu', e => e.preventDefault());
        document.addEventListener('keydown', function(e) {
            if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J')) || (e.ctrlKey && e.key === 'U')) {
                e.preventDefault();
                handleSecurityBreach('Attempted to open DevTools via keyboard');
            }
        });

        setInterval(detectDevTools, 500);

        // ========== DATA & SETUP ==========
        let currentUser = null;
        let deviceId = localStorage.getItem('oxy_device_id') || 'OXYX-' + Math.random().toString(36).substring(2,10).toUpperCase();
        localStorage.setItem('oxy_device_id', deviceId);
        let activeSessions = JSON.parse(localStorage.getItem('activeSessions')) || {};
        let members = JSON.parse(localStorage.getItem('members')) || [];
        let builds = JSON.parse(localStorage.getItem('builds')) || [];
        let activityLogs = JSON.parse(localStorage.getItem('activityLogs')) || [];
        let bannedUsers = JSON.parse(localStorage.getItem('bannedUsers')) || [];
        let bugReports = JSON.parse(localStorage.getItem('bugReports')) || [];
        let currentIP = '';

        // Enhanced WHID system with password reset
        let validWHIDs = JSON.parse(localStorage.getItem('validWHIDs')) || {
            'znyt': 'WHID-OWNER-7K9P2X8M4N6Q',
            'helper_tester': 'WHID-MOD-3F8H5J2L9R4T',
            'sigma': 'WHID-MOD-6B1N8K3P7W5Z'
        };

        let modPasswords = JSON.parse(localStorage.getItem('modPasswords')) || {
            'helper_tester': 'huwydhdjsiqo',
            'sigma': 'uBwbONeqIwYQ97'
        };

        fetch('https://api.ipify.org?format=json').then(r => r.json()).then(d => currentIP = d.ip);

        function addLog(action, details) {
            const log = { timestamp: new Date().toISOString(), user: currentUser ? currentUser.username : 'System', action, details, ip: currentIP };
            activityLogs.unshift(log);
            if (activityLogs.length > 200) activityLogs.pop();
            localStorage.setItem('activityLogs', JSON.stringify(activityLogs));
        }

        // ========== CORE FUNCTIONS ==========
        window.forceUnbind = function() {
            let user = document.getElementById('adminUser').value || document.getElementById('memberUsername').value;
            if(!user) return alert("Enter username first!");
            if (currentUser && currentUser.role !== 'owner') return alert("‚ùå Only owner can force unbind!");
            delete activeSessions[user];
            localStorage.setItem('activeSessions', JSON.stringify(activeSessions));
            document.getElementById('sessionWarning').classList.add('hidden');
            addLog('FORCE_UNBIND', `Forced unbind user: ${user}`);
            alert("‚úÖ Session reset successfully!");
        };

        window.loginMember = function() {
            if (securityBreach) return alert('‚ùå Security breach detected. Access denied.');
            let user = document.getElementById('memberUsername').value.trim();
            if (!user) return alert('Please enter username!');
            if (bannedUsers.includes(user)) return alert('‚ùå Account banned!');
            if (activeSessions[user] && activeSessions[user] !== deviceId) {
                document.getElementById('sessionWarning').classList.remove('hidden');
                return;
            }
            loginFinalize(user, 'member');
        };

        window.loginAdmin = function() {
            if (securityBreach) return alert('‚ùå Security breach detected. Access denied.');
            let user = document.getElementById('adminUser').value.trim();
            let pass = document.getElementById('adminPass').value.trim();
            let whid = document.getElementById('whidInput').value.trim();
            
            if (bannedUsers.includes(user)) return alert('‚ùå Account banned!');
            if (!validWHIDs[user]) {
                handleSecurityBreach(`Unknown entity attempted admin login: ${user}`);
                return;
            }
            if (!whid || validWHIDs[user] !== whid) {
                handleSecurityBreach(`Invalid WHID for user: ${user}`);
                return;
            }
            if (activeSessions[user] && activeSessions[user] !== deviceId) {
                document.getElementById('sessionWarning').classList.remove('hidden');
                return;
            }
            
            if (user === 'znyt' && pass === 'Root!Delta_7KpZ') {
                loginFinalize(user, 'owner');
            } else if (modPasswords[user] && modPasswords[user] === pass) {
                loginFinalize(user, 'mod');
            } else {
                handleSecurityBreach(`Failed admin login attempt: ${user}`);
            }
        };

        function loginFinalize(user, role) {
            currentUser = { username: user, role: role };
            activeSessions[user] = deviceId;
            localStorage.setItem('activeSessions', JSON.stringify(activeSessions));

            let now = new Date().toISOString();
            let idx = members.findIndex(m => m.username === user);
            if(idx > -1) {
                members[idx].lastSeen = now;
                members[idx].ip = currentIP;
                members[idx].role = role;
            } else {
                members.push({ username: user, ip: currentIP, deviceId: deviceId, lastSeen: now, role: role });
            }
            localStorage.setItem('members', JSON.stringify(members));
            
            addLog('LOGIN', `User ${user} (${role}) logged in successfully`);
            showUserInfo();
            alert('‚úÖ Login successful as ' + role.toUpperCase());
        }

        function showUserInfo() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('sessionWarning').classList.add('hidden');
            document.getElementById('userInfo').classList.remove('hidden');
            document.getElementById('displayName').innerText = currentUser.username + ' (' + currentUser.role + ')';
            document.getElementById('uploadSection').classList.remove('hidden');
            
            if (currentUser.role === 'owner') {
                document.getElementById('ownerPanel').classList.remove('hidden');
            }
        }

        window.logout = function() {
            if (currentUser) {
                addLog('LOGOUT', `User ${currentUser.username} logged out`);
                delete activeSessions[currentUser.username];
                localStorage.setItem('activeSessions', JSON.stringify(activeSessions));
            }
            location.reload();
        };

        // ========== MODERATOR PASSWORD RESET ==========
        window.resetModPassword = function() {
            if (currentUser.role !== 'owner') return alert('‚ùå Only owner can reset passwords!');
            let modUser = document.getElementById('modSelect').value;
            let newPass = document.getElementById('newModPass').value.trim();
            if (!modUser || !newPass) return alert('Select moderator and enter new password!');
            if (newPass.length < 8) return alert('Password must be at least 8 characters!');
            
            if (confirm(`Reset password for ${modUser}?`)) {
                modPasswords[modUser] = newPass;
                localStorage.setItem('modPasswords', JSON.stringify(modPasswords));
                if (activeSessions[modUser]) {
                    delete activeSessions[modUser];
                    localStorage.setItem('activeSessions', JSON.stringify(activeSessions));
                }
                document.getElementById('newModPass').value = '';
                addLog('RESET_MOD_PASSWORD', `Reset password for: ${modUser}`);
                alert(`‚úÖ Password reset for ${modUser}!`);
            }
        };

        // ========== BUILD UPLOAD & DOWNLOAD ==========
        window.uploadBuild = function() {
            if (!currentUser) return alert('Login required!');
            const file = document.getElementById('buildFile').files[0];
            const image = document.getElementById('buildImage').files[0];
            const name = document.getElementById('buildName').value.trim();
            const desc = document.getElementById('buildDesc').value.trim();
            const price = parseInt(document.getElementById('buildPrice').value);

            if (!file) return alert("Please upload build file");
            if (file.name.split('.').pop().toLowerCase() !== 'build') return alert("Only .build files allowed!");
            if (!desc) return alert("Please add description");
            if (isNaN(price)) return alert("Please set price");
            if (!name) return alert("Please enter build name");

            let imageData = null;
            if (image) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imageData = e.target.result;
                    saveBuild();
                };
                reader.readAsDataURL(image);
            } else {
                saveBuild();
            }

            function saveBuild() {
                builds.push({ 
                    id: Date.now(), name, price, desc, file: file.name, seller: currentUser.username,
                    type: price >= 100 ? 'premium' : 'non-premium', image: imageData, uploadDate: new Date().toISOString()
                });
                localStorage.setItem('builds', JSON.stringify(builds));
                
                // Clear form
                ['buildName', 'buildPrice', 'buildDesc', 'buildFile', 'buildImage'].forEach(id => document.getElementById(id).value = '');
                document.getElementById('imagePreview').innerHTML = '';
                
                addLog('UPLOAD_BUILD', `Uploaded: ${name} (${price} Robux)`);
                alert(`‚úÖ Build published successfully!`);
                displayBuilds();
                updateStats();
            }
        };

        // Image preview
        document.getElementById('buildImage').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('imagePreview').innerHTML = `<img src="${e.target.result}" class="build-preview" alt="Preview">`;
                };
                reader.readAsDataURL(file);
            }
        });

        window.displayBuilds = function(filter = 'all') {
            let container = document.getElementById('marketplace');
            let filtered = builds;
            if (filter === 'free') filtered = builds.filter(b => b.price === 0);
            if (filter === 'premium') filtered = builds.filter(b => b.price >= 100);
            if (filter === 'my') filtered = builds.filter(b => b.seller === currentUser?.username);

            container.innerHTML = filtered.length ? '' : '<p>No builds available.</p>';
            filtered.reverse().forEach(b => {
                let card = document.createElement('div');
                card.className = `build-card ${b.price >= 100 ? 'premium-build' : ''}`;
                
                let imageHtml = b.image ? `<img src="${b.image}" class="build-preview" alt="${b.name}">` : 
                    '<div style="height:150px; background:#333; border-radius:10px; display:flex; align-items:center; justify-content:center; color:#666;">No Preview</div>';
                
                card.innerHTML = `
                    ${imageHtml}
                    <h3>${b.name} ${b.price>=100?'üíé':''}</h3>
                    <p style="color:gold;">üí∞ ${b.price} Robux</p>
                    <p style="font-size:12px; color:#aaa; margin:10px 0;">${b.desc}</p>
                    <p style="font-size:10px; color:#666;">By: ${b.seller}</p>
                    <button style="margin-top:15px; background:#00aa00; width:100%;" onclick="downloadBuild('${b.name}', '${b.file}')">‚¨áÔ∏è DOWNLOAD</button>
                `;
                container.appendChild(card);
            });
        };

        window.downloadBuild = function(name, file) {
            addLog('DOWNLOAD_BUILD', `Downloaded: ${name}`);
            const link = document.createElement('a');
            link.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(`OXYX Market Build\nName: ${name}\nFile: ${file}\nDownloaded: ${new Date().toLocaleString()}`);
            link.download = file;
            link.click();
            alert(`Downloading ${file}...`);
        };

        window.filterBuilds = (f) => displayBuilds(f);

        // ========== FAQ & BUG REPORT ==========
        window.toggleFAQ = function(index) {
            let answers = document.querySelectorAll('.faq-answer');
            let answer = answers[index];
            answers.forEach((a, i) => { if (i !== index) a.classList.remove('active'); });
            answer.classList.toggle('active');
        };

        window.reportBug = function() {
            let title = document.getElementById('bugTitle').value.trim();
            let desc = document.getElementById('bugDesc').value.trim();
            let severity = document.getElementById('bugSeverity').value;
            
            if (!title) return alert('Enter bug title!');
            if (!desc) return alert('Describe the bug!');
            
            bugReports.push({
                id: Date.now(), title, description: desc, severity,
                reporter: currentUser ? currentUser.username : 'Anonymous',
                reportDate: new Date().toISOString(), status: 'open'
            });
            localStorage.setItem('bugReports', JSON.stringify(bugReports));
            
            ['bugTitle', 'bugDesc'].forEach(id => document.getElementById(id).value = '');
            document.getElementById('bugSeverity').value = 'low';
            
            addLog('BUG_REPORT', `Bug reported: ${title} (${severity})`);
            alert('‚úÖ Bug report submitted successfully!');
        };

        function updateStats() {
            document.getElementById('totalMembers').innerText = members.length;
            document.getElementById('totalBuilds').innerText = builds.length;
            document.getElementById('onlineNow').innerText = Object.keys(activeSessions).length;
        }

        // Initialize
        updateStats();
        displayBuilds();
        if (blockedUntil && new Date() < new Date(blockedUntil)) showBlockedScreen();
        if (securityBreach) document.getElementById('securityWarning').classList.remove('hidden');

        // Console warning
        console.log('%cSTOP!', 'color: red; font-size: 50px; font-weight: bold;');
        console.log('%cOXYX MARKET - Unauthorized access prohibited', 'color: #b300ff; font-size: 14px;');
    </script>
</body>
</html>
